# 一键分配人数验证功能说明

## 概述
修复了一键分配功能的逻辑漏洞，现在会严格验证每个岗位的人数是否满足开发需求。

## 问题
之前的逻辑允许人数不足的项目也被分配员工，导致只有1名程序员也能开发游戏的不合理情况。

## 解决方案

### 1. 人数验证规则
每个游戏项目必须满足以下人数要求才能被分配员工：
- **程序员**：至少5人
- **策划师**：至少5人  
- **美术师**：至少5人
- **音效师**：至少5人
- **客服**：不参与游戏开发，无需分配

**总计**：每个项目需要20名开发人员（4个岗位 × 5人）

### 2. 核心修改

#### EnhancedAssignmentService.kt
- 新增 `EmployeeCheckResult` 数据类：用于返回人数检查结果
- 新增 `checkEmployeeAvailability()` 函数：
  - 检查可用员工中各岗位人数是否满足5人需求
  - 返回检查结果和详细的不足信息
- 修改 `assignBestEmployeesToProjects()` 函数：
  - 在分配前先调用 `checkEmployeeAvailability()` 检查人数
  - 人数不足的项目记录到 `failedProjects` 而不是强行分配
  - 只有人数满足要求的项目才会进行实际分配
- 修改 `EnhancedAssignmentResult` 数据类：
  - 新增 `failedProjects: Map<String, String>` 字段
  - 记录无法分配的项目ID和失败原因

#### EnhancedAssignmentResultDialog.kt
- 新增 `FailedProjectsCard` 组件：
  - 显示无法分配的项目列表
  - 显示每个项目的具体缺少人数信息
  - 使用红色警告样式突出显示
- 修改 `AssignmentSummaryCard` 组件：
  - 在摘要中显示失败项目数量的警告提示
  - 提示文案："有 X 个项目因人数不足无法分配"
- 修改按钮逻辑：
  - 如果所有项目都无法分配（`assignments.isEmpty()`），只显示"关闭"按钮
  - 如果有成功分配的项目，显示"重新分配"和"确认分配"按钮
- 更新 "无法分配员工" 文案为 "无法分配的员工"（更准确描述客服等无法参与开发的员工）

### 3. 用户体验优化

#### 分配结果展示
1. **摘要区域**：
   - 显示已分配员工数、成功分配项目数、剩余员工数
   - 如果有失败项目，显示红色警告框

2. **详细信息区域**：
   - 成功分配的项目：显示绿色卡片，列出分配的20名员工
   - 失败的项目：显示红色卡片，列出具体缺少哪些岗位、缺少多少人
   - 无法分配的员工：显示黄色卡片（如客服）

#### 提示信息示例
```
❌ 无法分配的项目 (1个)

【游戏项目A】
⚠️ 程序员需要5人，当前只有1人；策划师需要5人，当前只有3人
```

## 使用场景

### 场景1：人数充足
- 公司有25名员工：5程序、5策划、5美术、5音效、5客服
- 创建1个游戏项目
- 点击"一键分配" → 成功分配20人到项目，5名客服显示在"无法分配的员工"中

### 场景2：人数不足
- 公司有10名员工：1程序、3策划、2美术、2音效、2客服
- 创建1个游戏项目  
- 点击"一键分配" → 项目显示在"无法分配的项目"中
- 提示："程序员需要5人，当前只有1人；策划师需要5人，当前只有3人；美术师需要5人，当前只有2人；音效师需要5人，当前只有2人"
- 只显示"关闭"按钮，无法确认分配

### 场景3：多项目部分成功
- 公司有45名员工：各岗位充足
- 创建3个游戏项目
- 点击"一键分配" → 前2个项目成功分配（消耗40人），第3个项目因剩余人数不足而失败
- 显示"重新分配"和"确认分配"按钮，玩家可以选择确认前2个项目的分配

## 技术实现

### 数据流
```
1. 玩家点击"一键分配"
2. EnhancedAssignmentService.assignBestEmployeesToProjects()
3. 对每个项目：
   a. checkEmployeeAvailability() - 检查人数
   b. 如果人数不足 → 添加到 failedProjects
   c. 如果人数充足 → assignBestEmployeesToProject() 进行分配
4. 返回 EnhancedAssignmentResult（包含成功分配的项目和失败的项目）
5. EnhancedAssignmentResultDialog 显示结果
```

### 关键函数
```kotlin
// 检查人数是否满足需求
private fun checkEmployeeAvailability(
    availableEmployees: List<Employee>
): EmployeeCheckResult {
    // 统计各岗位人数
    // 检查是否满足每个岗位5人的需求
    // 返回检查结果和不足信息
}
```

## 修改文件清单
1. `EnhancedAssignmentService.kt` - 核心分配逻辑
2. `EnhancedAssignmentResultDialog.kt` - UI展示和用户反馈

## 测试建议
1. 创建一个新存档，只招聘1名程序员，尝试一键分配 → 应该提示人数不足
2. 招聘满20名开发人员（每个岗位5人），尝试一键分配 → 应该成功分配
3. 招聘40名开发人员，创建3个项目，尝试一键分配 → 前2个成功，第3个失败
4. 招聘一些客服，尝试一键分配 → 客服应该显示在"无法分配的员工"中

## 注意事项
- 此修改确保了游戏开发的真实性和平衡性
- 玩家必须合理规划公司规模和项目数量
- 建议在游戏早期给予玩家提示，说明每个项目需要20名开发人员
