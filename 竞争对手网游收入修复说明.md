# 竞争对手网游收入修复说明

## 问题描述

竞争对手的网游总收入会长时间维持在同个数目，即使活跃玩家数在变化，总收入显示也几乎不变。

## 根本原因

1. **缺少累计收入字段**：`CompetitorGame`数据类没有存储累计收入的字段
2. **使用瞬时估算**：收入显示使用简单公式估算（`活跃玩家 × 评分 × 100`），而不是真正的累计收入
3. **每月未累加**：每月更新时只更新了活跃玩家数，没有累加收入

## 解决方案

### 1. 添加累计收入字段

**文件**: `CompetitorData.kt`

给 `CompetitorGame` 添加 `totalRevenue` 字段：
```kotlin
data class CompetitorGame(
    // ... 其他字段
    val totalRevenue: Double = 0.0 // 累计总收入
)
```

### 2. 初始游戏收入计算

生成游戏时计算合理的初始累计收入：

- **网游**：`累计收入 = 每月收入 × 运营月数`
  - 每月收入 = 活跃玩家 × 付费率(0.5%) × ARPU(100元)
  
- **单机**：`累计收入 = 销量 × 单价(50元)`

### 3. 每月收入累加

每月更新时自动累加收入：

- **网游**：每月增加 `活跃玩家 × 0.005 × 100元`
- **单机**：每月增加 `新增销量 × 50元`

### 4. 更新显示逻辑

排行榜使用真实的 `totalRevenue` 字段显示，不再使用估算。

## 修改文件

1. **CompetitorData.kt**
   - 添加 `totalRevenue` 字段
   - 修改 `generateCompanyGames()` 计算初始收入
   - 修改 `updateCompetitors()` 每月累加收入
   - 修改 `generateNewGame()` 设置新游戏初始收入
   - 简化 `getTotalRevenue()` 直接累加真实收入

2. **CompetitorScreen.kt**
   - 修改 `getTopOnlineGames()` 使用真实收入
   - 修改 `getTopOnlineGamesWithFluctuation()` 使用真实收入

## 数值设计

- **网游付费率**: 0.5%（与玩家游戏付费率一致）
- **网游ARPU**: 100元/月
- **单机游戏单价**: 50元

## 效果

- ✅ 网游总收入每月随活跃玩家数变化而累加
- ✅ 单机游戏总收入每月随销量增长而累加
- ✅ 排行榜显示真实的累计收入，不再是估算值
- ✅ 旧存档兼容性：旧游戏的 `totalRevenue` 默认为 0，会在下次月结算时自动修正

## 向后兼容

由于旧存档中的 `CompetitorGame` 没有 `totalRevenue` 字段，使用默认值 `0.0`。在下一次月结算时，系统会自动开始累加收入，虽然起点为0，但不影响游戏性。

如需修正旧存档数据，可以在 `updateCompetitors()` 中添加一次性的修正逻辑，根据游戏的运营月数和当前玩家数/销量估算历史累计收入。
