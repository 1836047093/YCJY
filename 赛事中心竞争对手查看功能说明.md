# 赛事中心竞争对手查看功能说明

## 功能概述

为赛事中心的"进行中"标签页添加下拉选择器，玩家可以查看竞争对手公司正在举办的电竞赛事。

## 核心实现

### 1. 数据结构修改

**CompetitorGame 数据类**（`CompetitorData.kt`）
- 新增 `currentTournament: EsportsTournament?` - 当前进行中的赛事
- 新增 `lastTournamentDate: GameDate?` - 上次举办赛事的日期
- 新增 `tournamentHistory: List<EsportsTournament>?` - 赛事历史记录

### 2. 竞争对手赛事系统

**AI举办赛事**（`CompetitorManager`）

新增函数：
- `updateCompetitorTournaments()` - 更新竞争对手的赛事进度并尝试举办新赛事
  - 更新进行中赛事的当前天数
  - 赛事结束时自动完成并添加到历史记录
  - 尝试举办新赛事

- `tryHostTournamentForCompetitor()` - 修改为返回 `Triple(游戏ID, 赛事对象, 新闻)`
  - 创建真实的 `EsportsTournament` 对象
  - 不仅生成新闻，还将赛事信息存储到游戏数据中

**举办条件**：
- 竞技类网游（MOBA/射击/体育/竞速/策略）
- 评分 ≥ 6.0
- 活跃玩家 ≥ 1万
- 没有进行中的赛事

**举办概率**：
- 基础概率：5%
- 活跃玩家 > 50万：+3%
- 平均评分 > 8.0：+2%
- 公司市值 > 5000万：+2%

**赛事规模**（根据活跃玩家数）：
- ≥ 50万：世界总决赛
- ≥ 20万：国际赛
- ≥ 5万：全国赛
- < 5万：区域赛

### 3. UI界面改进

**TournamentScreen**（`TournamentScreen.kt`）
- 新增 `competitors: List<CompetitorCompany>` 参数

**OngoingTournamentsTab**
- 添加下拉选择器（`ExposedDropdownMenuBox`）
  - 默认显示"我的公司"
  - 列表包含所有竞争对手公司（9家）
  
- 动态切换显示内容：
  - 选择"我的公司"：显示玩家自己的游戏赛事
  - 选择竞争对手：显示该竞争对手的进行中赛事

**OngoingTournamentCard**
- 新增 `companyName: String?` 参数
- 查看竞争对手赛事时，在卡片右上角显示公司名称标签（蓝色背景）

### 4. 数据流转

```
MainActivity 
  ↓ (传递 competitors)
TournamentScreen 
  ↓ (传递 competitors)
OngoingTournamentsTab
  ↓ (根据选择获取对应公司的游戏)
  ↓ (CompetitorGame → 临时 Game 对象)
OngoingTournamentCard
```

## UI效果

### 下拉选择器
- 位置：赛事中心 → 进行中标签页 → 顶部
- 样式：`OutlinedTextField` + 下拉菜单
- 选项：我的公司、光源互娱、棱镜游戏、梦境互娱...（共10个）

### 赛事卡片
- **我的公司**：正常显示，包含活跃玩家、热度指数等详细数据
- **竞争对手**：
  - 右上角显示公司名称（蓝色标签）
  - 显示赛事类型、游戏名、进度条、当前阶段
  - 不显示收益数据（因为没有 revenueData）

### 空状态
- 我的公司无赛事："去可举办页面创建新赛事吧！"
- 竞争对手无赛事："该公司暂无进行中的赛事"

## 月度更新逻辑

每月结算时（`CompetitorManager.updateCompetitors()`）：
1. 所有进行中的赛事天数 +1
2. 赛事天数达到 `type.duration` 时自动完成
3. 完成的赛事添加到 `tournamentHistory`（保留最近5场）
4. 随机尝试举办新赛事（5-12%概率）

## 向后兼容

- `currentTournament`、`lastTournamentDate`、`tournamentHistory` 默认值为 `null` 或空列表
- 旧存档自动兼容，竞争对手会在下次月结算时开始举办赛事

## 技术亮点

✅ 复用玩家赛事系统的逻辑（`TournamentManager.completeTournament()`）
✅ 统一的赛事数据结构（`EsportsTournament`）
✅ 智能的赛事规模选择（基于活跃玩家数）
✅ 清晰的UI交互（下拉选择 + 公司名称标签）
✅ 完整的空状态处理

## 文件修改清单

1. **CompetitorData.kt**
   - CompetitorGame 添加赛事字段
   - updateCompetitorTournaments() 新增函数
   - tryHostTournamentForCompetitor() 修改返回值和逻辑

2. **TournamentScreen.kt**
   - TournamentScreen() 添加 competitors 参数
   - OngoingTournamentsTab() 完全重写，添加下拉选择器
   - OngoingTournamentCard() 添加 companyName 参数和显示

3. **MainActivity.kt**
   - TournamentScreen 调用时传入 competitors 参数

## 使用方式

1. 进入赛事中心
2. 点击"⏳ 进行中"标签页
3. 点击顶部的下拉选择器
4. 选择要查看的公司（我的公司 或 竞争对手）
5. 查看对应公司的进行中赛事

## 未来改进方向

- [ ] 添加历史赛事查看（可以查看竞争对手的历史赛事）
- [ ] 赛事对比功能（对比不同公司的赛事规模和成功度）
- [ ] 赛事通知（竞争对手举办大型赛事时弹出提示）
- [ ] 赛事排行榜（展示所有公司的赛事成就）
