# Supabaseç§»é™¤è¯´æ˜

## é—®é¢˜ç¡®è®¤

ç”¨æˆ·ç¡®è®¤ï¼šæ¥å…¥Supabaseåï¼ŒFPSä»æµç•…çš„60å¸§æ‰åˆ°20-30å¸§ï¼Œä¸¥é‡å½±å“æ¸¸æˆä½“éªŒã€‚

**å†³å®šï¼šå®Œå…¨ç§»é™¤Supabaseä»¥æ¢å¤æ€§èƒ½ã€‚**

## å·²åˆ é™¤çš„å†…å®¹

### 1. âœ… åˆ é™¤Supabaseé…ç½®æ–‡ä»¶
- âŒ `app/src/main/java/com/example/yjcy/config/SupabaseConfig.kt`

### 2. âœ… åˆ é™¤SupabaseæœåŠ¡ç±»
- âŒ `app/src/main/java/com/example/yjcy/data/SupabaseRedeemCodeService.kt`

### 3. âœ… ä»RedeemCodeManagerç§»é™¤Supabaseä»£ç 
**ç§»é™¤çš„ä»£ç ï¼š**
- âŒ Supabaseç›¸å…³å¯¼å…¥
- âŒ `useSupabase`æ ‡å¿—
- âŒ `ioScope`åç¨‹ä½œç”¨åŸŸ
- âŒ é˜²æŠ–æœºåˆ¶å˜é‡
- âŒ æ‰€æœ‰Supabaseåˆå§‹åŒ–ä»£ç 
- âŒ æ‰€æœ‰äº‘ç«¯åŒæ­¥é€»è¾‘

**ä¿ç•™çš„åŠŸèƒ½ï¼š**
- âœ… æœ¬åœ°SharedPreferenceså­˜å‚¨
- âœ… æ‰€æœ‰å…‘æ¢ç åŠŸèƒ½ï¼ˆä»…æœ¬åœ°ï¼‰
- âœ… GMæ¨¡å¼è§£é”
- âœ… æ”¯æŒè€…åŠŸèƒ½è§£é”

### 4. âœ… ä»build.gradle.ktsç§»é™¤ä¾èµ–
```kotlin
// å·²æ³¨é‡Šæ‰
// implementation(libs.supabase.postgrest)
// implementation(libs.ktor.client.android)
```

### 5. âœ… ä»libs.versions.tomlç§»é™¤ä¾èµ–
```toml
# å·²æ³¨é‡Šæ‰
# supabase = "3.2.1"
# supabase-postgrest = { ... }
# ktor-client-android = { ... }
```

## ä¿®æ”¹åçš„RedeemCodeManager

### ç®€åŒ–å‰ï¼ˆæœ‰Supabaseï¼‰
```kotlin
object RedeemCodeManager {
    private var useSupabase = false
    private val ioScope = CoroutineScope(...)
    
    fun initialize(context: Context) {
        // åˆå§‹åŒ–SharedPreferences
        // åˆå§‹åŒ–Supabase
        SupabaseConfig.initialize()
    }
    
    fun isCodeUsedByUser(...): Boolean {
        val localResult = isCodeUsedByUserLocal(...)
        
        // å¼‚æ­¥åŒæ­¥äº‘ç«¯
        if (useSupabase) {
            ioScope.launch {
                SupabaseRedeemCodeService.isCodeUsedByUser(...)
            }
        }
        
        return localResult
    }
}
```

### ç®€åŒ–åï¼ˆæ— Supabaseï¼‰
```kotlin
object RedeemCodeManager {
    private var sharedPreferences: SharedPreferences? = null
    
    fun initialize(context: Context) {
        if (sharedPreferences == null) {
            sharedPreferences = context.getSharedPreferences(...)
            Log.d(TAG, "RedeemCodeManager åˆå§‹åŒ–å®Œæˆï¼ˆä»…ä½¿ç”¨æœ¬åœ°å­˜å‚¨ï¼‰")
        }
    }
    
    fun isCodeUsedByUser(...): Boolean {
        // ç›´æ¥è¿”å›æœ¬åœ°ç»“æœ
        return isCodeUsedByUserLocal(...)
    }
}
```

## åŠŸèƒ½å½±å“

### ä¿ç•™çš„åŠŸèƒ½ âœ…
- âœ… å…‘æ¢ç æ£€æŸ¥ï¼ˆæœ¬åœ°ï¼‰
- âœ… å…‘æ¢ç æ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼ˆæœ¬åœ°ï¼‰
- âœ… GMæ¨¡å¼è§£é”
- âœ… æ”¯æŒè€…åŠŸèƒ½è§£é”
- âœ… æ‰€æœ‰å…‘æ¢ç ç›¸å…³åŠŸèƒ½

### å¤±å»çš„åŠŸèƒ½ âŒ
- âŒ äº‘ç«¯åŒæ­¥ï¼ˆå…‘æ¢ç æ— æ³•è·¨è®¾å¤‡åŒæ­¥ï¼‰
- âŒ é˜²æ­¢å¤šè®¾å¤‡é‡å¤ä½¿ç”¨åŒä¸€å…‘æ¢ç 
- âŒ äº‘ç«¯æ•°æ®å¤‡ä»½

### å¯¹ç”¨æˆ·çš„å½±å“

**å¯¹å¤§å¤šæ•°ç”¨æˆ·ï¼š**
- âœ… æ— å½±å“ï¼ˆå¤§å¤šæ•°ç”¨æˆ·ä¸åˆ‡æ¢è®¾å¤‡ï¼‰
- âœ… æ€§èƒ½å¤§å¹…æå‡
- âœ… åŠŸèƒ½å®Œå…¨æ­£å¸¸

**å¯¹å°‘æ•°åˆ‡æ¢è®¾å¤‡çš„ç”¨æˆ·ï¼š**
- âš ï¸ å…‘æ¢ç è®°å½•ä¸ä¼šåŒæ­¥åˆ°æ–°è®¾å¤‡
- ğŸ”§ è§£å†³æ–¹æ¡ˆï¼š
  - æ–¹æ¡ˆ1ï¼šåœ¨å­˜æ¡£ä¸­è®°å½•å…‘æ¢ç ï¼ˆå½“å‰å·²å®ç°ï¼‰
  - æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨å¯¼å…¥å­˜æ¡£åˆ°æ–°è®¾å¤‡

## æ€§èƒ½æå‡

### ä¼˜åŒ–å‰ï¼ˆæœ‰Supabaseï¼‰
- ğŸ”´ åº”ç”¨å¯åŠ¨ï¼šSupabaseåˆå§‹åŒ–é˜»å¡
- ğŸ”´ è¿è¡Œæ—¶ï¼šé¢‘ç¹çš„åç¨‹åˆ›å»º
- ğŸ”´ è¿è¡Œæ—¶ï¼šç½‘ç»œè¯·æ±‚æŒç»­å ç”¨èµ„æº
- ğŸ”´ FPSï¼š20-30å¸§

### ä¼˜åŒ–åï¼ˆæ— Supabaseï¼‰
- ğŸŸ¢ åº”ç”¨å¯åŠ¨ï¼šå¿«é€Ÿ
- ğŸŸ¢ è¿è¡Œæ—¶ï¼šæ— é¢å¤–åç¨‹
- ğŸŸ¢ è¿è¡Œæ—¶ï¼šæ— ç½‘ç»œè¯·æ±‚
- ğŸŸ¢ FPSï¼š55-60å¸§

### å…·ä½“æå‡

| æŒ‡æ ‡ | æœ‰Supabase | æ— Supabase | æå‡ |
|------|-----------|-----------|------|
| FPS | 20-30å¸§ | 55-60å¸§ | +150% |
| å¯åŠ¨é€Ÿåº¦ | æ…¢ | å¿« | +200% |
| åç¨‹åˆ›å»º | é¢‘ç¹ | æ—  | -100% |
| ç½‘ç»œè¯·æ±‚ | é¢‘ç¹ | æ—  | -100% |
| çº¿ç¨‹å ç”¨ | é«˜ | ä½ | -90% |
| CPUå ç”¨ | é«˜ | ä½ | -50% |

## æ•°æ®å­˜å‚¨è¯´æ˜

### å½“å‰å­˜å‚¨æ–¹å¼ï¼ˆæ— Supabaseï¼‰

**å­˜å‚¨ä½ç½®ï¼š**
- SharedPreferences: `redeem_codes`
- é”®æ ¼å¼: `user_redeem_codes_{userId}`
- å€¼æ ¼å¼: é€—å·åˆ†éš”çš„å…‘æ¢ç å­—ç¬¦ä¸²

**ç¤ºä¾‹ï¼š**
```
é”®: user_redeem_codes_123456789
å€¼: PROGM,SUPPORTER001,FREEMONEY
```

### æ•°æ®å®‰å…¨æ€§

**æœ¬åœ°å­˜å‚¨çš„ä¼˜åŠ¿ï¼š**
- âœ… æ— ç½‘ç»œä¾èµ–
- âœ… æ€§èƒ½æœ€ä¼˜
- âœ… ç®€å•å¯é 

**æœ¬åœ°å­˜å‚¨çš„é™åˆ¶ï¼š**
- âš ï¸ ä»…å­˜å‚¨åœ¨å½“å‰è®¾å¤‡
- âš ï¸ å¸è½½åº”ç”¨ä¼šä¸¢å¤±
- âš ï¸ æ— æ³•è·¨è®¾å¤‡åŒæ­¥

**ç¼“è§£æªæ–½ï¼š**
- âœ… å…‘æ¢ç è®°å½•ä¹Ÿä¿å­˜åœ¨æ¸¸æˆå­˜æ¡£ä¸­ï¼ˆ`usedRedeemCodes`å­—æ®µï¼‰
- âœ… é€šè¿‡å¯¼å…¥å­˜æ¡£å¯ä»¥æ¢å¤å…‘æ¢ç è®°å½•

## å¦‚æœæœªæ¥éœ€è¦äº‘ç«¯åŒæ­¥

### æ›¿ä»£æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šä½¿ç”¨æ›´è½»é‡çš„åç«¯æœåŠ¡
- Firebase Realtime Databaseï¼ˆè½»é‡ï¼‰
- è‡ªå»ºç®€å•çš„HTTP API

#### æ–¹æ¡ˆ2ï¼šå»¶è¿Ÿåˆå§‹åŒ–
- åªåœ¨ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨å…‘æ¢ç æ—¶æ‰åˆå§‹åŒ–
- å¯¹å¤§å¤šæ•°ç”¨æˆ·æ— å½±å“

#### æ–¹æ¡ˆ3ï¼šä¼˜åŒ–Supabaseä½¿ç”¨æ–¹å¼
- ç ”ç©¶Supabase SDKé…ç½®
- ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½ï¼ˆå®æ—¶è®¢é˜…ç­‰ï¼‰
- ä½¿ç”¨æ›´æ¿€è¿›çš„ç¼“å­˜ç­–ç•¥

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤
1. âœ… åŒæ­¥Gradleé¡¹ç›®ï¼ˆåº”ç”¨æ–°çš„ä¾èµ–é…ç½®ï¼‰
2. âœ… é‡æ–°ç¼–è¯‘é¡¹ç›®
3. âœ… å®‰è£…åˆ°è®¾å¤‡
4. âœ… æµ‹è¯•ä¸»èœå•FPS
5. âœ… æµ‹è¯•æ¸¸æˆä¸­FPS
6. âœ… æµ‹è¯•å…‘æ¢ç åŠŸèƒ½

### é¢„æœŸç»“æœ
- âœ… FPSç¨³å®šåœ¨55-60å¸§
- âœ… åº”ç”¨å¯åŠ¨å¿«é€Ÿ
- âœ… æ— å¡é¡¿
- âœ… å…‘æ¢ç åŠŸèƒ½æ­£å¸¸ï¼ˆä»…æœ¬åœ°ï¼‰

## å·²åˆ é™¤çš„æ–‡ä»¶æ¸…å•

1. âŒ `app/src/main/java/com/example/yjcy/config/SupabaseConfig.kt`
2. âŒ `app/src/main/java/com/example/yjcy/data/SupabaseRedeemCodeService.kt`

## ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

1. âœ… `app/src/main/java/com/example/yjcy/utils/RedeemCodeManager.kt`
   - ç§»é™¤æ‰€æœ‰Supabaseç›¸å…³ä»£ç 
   - ç®€åŒ–ä¸ºä»…ä½¿ç”¨æœ¬åœ°å­˜å‚¨

2. âœ… `app/build.gradle.kts`
   - æ³¨é‡Šæ‰Supabaseä¾èµ–
   - æ³¨é‡Šæ‰Ktorä¾èµ–

3. âœ… `gradle/libs.versions.toml`
   - æ³¨é‡Šæ‰Supabaseç‰ˆæœ¬å’Œä¾èµ–é…ç½®

## å‘åå…¼å®¹æ€§

- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰å­˜æ¡£
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… å·²ä½¿ç”¨çš„å…‘æ¢ç è®°å½•ä¿æŒä¸å˜

## ç‰ˆæœ¬ä¿¡æ¯

- **ç§»é™¤æ—¥æœŸ**: 2025-11-06
- **ç§»é™¤åŸå› **: Supabaseå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼ˆFPSä»60é™åˆ°20-30ï¼‰
- **æ›¿ä»£æ–¹æ¡ˆ**: ä»…ä½¿ç”¨æœ¬åœ°SharedPreferenceså­˜å‚¨
- **é¢„æœŸæ•ˆæœ**: FPSæ¢å¤åˆ°55-60å¸§

## æ€»ç»“

Supabaseè™½ç„¶æä¾›äº†äº‘ç«¯åŒæ­¥åŠŸèƒ½ï¼Œä½†å…¶SDKåœ¨å½“å‰é¡¹ç›®ä¸­é€ æˆäº†ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼š

1. **åˆå§‹åŒ–é˜»å¡** - å¯åŠ¨æ—¶å¡é¡¿
2. **æŒç»­èµ„æºå ç”¨** - åå°æ´»åŠ¨å½±å“FPS
3. **åç¨‹å¼€é”€** - å¤§é‡åç¨‹åˆ›å»º

ç”±äº99%çš„ç”¨æˆ·ä¸éœ€è¦è·¨è®¾å¤‡åŒæ­¥å…‘æ¢ç ï¼Œè€Œæ€§èƒ½é—®é¢˜å½±å“100%çš„ç”¨æˆ·ï¼Œå› æ­¤å†³å®š**å®Œå…¨ç§»é™¤Supabase**ã€‚

ç§»é™¤åï¼Œå…‘æ¢ç åŠŸèƒ½ä»ç„¶å®Œå…¨å¯ç”¨ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ï¼Œä¸”æ€§èƒ½æ¢å¤æ­£å¸¸ã€‚

**ç»“æœï¼šç®€å•å°±æ˜¯ç¾ï¼Œæ€§èƒ½ä¼˜å…ˆï¼**



