# 子公司员工系统重构说明

## 修改概述

将子公司的员工管理从**估算系统**改为**真实员工系统**，使其与玩家公司完全一致。

## 核心修改

### 1. 数据结构 (SubsidiaryData.kt)

**新增字段**：
```kotlin
val employees: List<Employee> = emptyList() // 真实员工列表
```

**修改说明**：
- `estimatedEmployeeCount` 保留仅用于向后兼容
- 新增 `employees` 字段存储真实员工列表
- 员工包含真实的姓名、职位、技能、薪资等完整信息

### 2. 员工生成逻辑

**generateSubsidiaryEmployees()** 函数：
- 根据游戏数量估算员工总数（最少10人）
- 根据游戏平均评分决定技能等级：
  - ≥8.5分 → 4级员工
  - ≥7.5分 → 3级员工
  - ≥6.5分 → 2级员工
  - <6.5分 → 1级员工

**职位分布**（5个职位各占20%）：
- 程序员（稍多）：开发技能
- 策划师：设计技能
- 美工：美术技能
- 音乐家：音乐技能
- 客服：服务技能

**薪资计算**：
- 基础薪资 = 技能等级 × 10,000元
- 随机浮动：±2,000元

### 3. 游戏开发进度计算（与玩家系统完全一致）

**updateDevelopingGames()** 函数：
- **设计阶段**：只有策划师贡献进度
- **美术音效阶段**：只有美工和音乐家贡献进度
- **程序实现阶段**：只有程序员贡献进度

**进度计算公式**：
```
进度增加 = 基础进度(2%) × 技能倍率 × 人数倍率
```

**技能倍率**：
- 平均4-5级：1.6倍
- 平均4级：1.3倍
- 平均3级：1.0倍
- 平均2级：0.8倍
- 平均1级：0.5倍

**人数倍率**：
- 1人：1.0倍
- 2人：1.3倍
- 3人：1.5倍
- 4+人：1.6倍

### 4. UI界面修改 (SubsidiaryScreen.kt)

**员工管理对话框**：
- ❌ 移除"管理层"显示
- ✅ "开发团队"改为"团队详情"
- ✅ 显示各职位的：
  - 人数
  - 专属技能平均等级（带⭐图标）

**显示格式**：
```
程序员  ⭐3.2级  4人
策划师  ⭐2.8级  2人
美工    ⭐3.0级  2人
音乐家  ⭐2.5级  2人
客服    ⭐2.0级  2人
```

### 5. 向后兼容性

**fixLegacySubsidiary()** 函数：
- 自动检测旧存档（employees为空）
- 基于游戏评分生成员工列表
- 计算真实工资总额
- 在 MainActivity 加载存档后自动调用

**修复逻辑**：
```kotlin
if (subsidiaries.isNotEmpty()) {
    val fixedSubsidiaries = subsidiaries.map { subsidiary ->
        SubsidiaryManager.fixLegacySubsidiary(subsidiary)
    }
    if (fixedSubsidiaries != subsidiaries) {
        subsidiaries = fixedSubsidiaries
        Log.d("MainActivity", "✅ 已修复旧存档的子公司员工列表")
    }
}
```

## 游戏平衡影响

### ✅ 优势
1. **真实感增强**：有真实的员工姓名和技能
2. **策略深度**：开发进度基于真实员工技能
3. **一致性**：与玩家公司系统完全对齐
4. **可扩展性**：未来可以添加员工培训、招聘等功能

### ⚠️ 数值变化
1. **开发速度**：
   - 高评分公司（4级员工）：开发更快
   - 低评分公司（1-2级员工）：开发较慢
   - 缺少某职位员工时，对应阶段进度为0

2. **工资成本**：
   - 使用真实员工薪资总额
   - 更精确的成本计算

## 修改文件清单

1. **SubsidiaryData.kt**：
   - 添加 `employees` 字段
   - 添加 `generateSubsidiaryEmployees()` 函数
   - 添加 `generateEmployeeName()` 函数
   - 修改 `updateDevelopingGames()` 函数（使用真实员工技能）
   - 添加 `fixLegacySubsidiary()` 函数（向后兼容）
   - 修改 `createSubsidiary()` 函数（生成员工列表）

2. **SubsidiaryScreen.kt**：
   - 修改 `EmployeeManagementDialog()` 组件
   - 移除"管理层"显示
   - 改为显示各职位人数和技能等级
   - 重命名 `EmployeeRoleRow` 为 `EmployeePositionRow`
   - 添加技能等级显示

3. **MainActivity.kt**：
   - 添加子公司员工列表修复逻辑
   - 在加载存档后自动调用 `fixLegacySubsidiary()`

## 测试建议

1. **新游戏**：
   - 收购竞争对手后查看员工列表
   - 验证员工技能等级与游戏评分匹配
   - 检查游戏开发进度是否正常增长

2. **旧存档**：
   - 加载旧版本存档
   - 验证自动生成员工列表
   - 检查日志输出修复信息

3. **游戏开发**：
   - 观察不同阶段的进度变化
   - 验证只有对应职位员工贡献进度
   - 测试缺少某职位员工时的行为

4. **UI显示**：
   - 检查"团队详情"显示正确
   - 验证技能等级格式化正确
   - 确认各职位颜色区分清晰

## 向后兼容保证

- ✅ 旧存档自动生成员工列表
- ✅ `estimatedEmployeeCount` 保留用于兼容
- ✅ 默认值 `employees = emptyList()` 确保不闪退
- ✅ 修复函数在加载时自动执行
- ✅ 详细日志记录修复过程

## 未来扩展可能性

1. **员工管理**：
   - 查看子公司员工详细信息
   - 调动员工到总公司或其他子公司
   - 为子公司招聘新员工

2. **员工培训**：
   - 提升子公司员工技能
   - 派遣总公司员工支援

3. **绩效考核**：
   - 根据员工技能调整薪资
   - 裁员或奖励机制

---

**修改日期**：2025-01-16  
**版本要求**：兼容所有旧版本存档
