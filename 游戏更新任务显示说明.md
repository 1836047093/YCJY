# 游戏更新任务显示优化

## 问题描述
当玩家点击"游戏更新"并选择更新内容后，创建的更新任务只存在于游戏收益数据中（`GameRevenue.updateTask`），但"当前项目"标签页只显示开发中的游戏，导致已发售游戏的更新任务无法在项目列表中看到，也无法分配员工进行更新工作。

## 解决方案

### 1. 修改项目过滤逻辑
**文件**: `EnhancedProjectManagement.kt`

"当前项目"标签页现在会同时显示：
- ✅ 开发中的游戏
- ✅ 准备发售的游戏
- ✅ 价格设置中的游戏
- ✅ **已发售但有进行中更新任务的游戏**（新增）

```kotlin
val filteredGames = remember(games, selectedProjectType, refreshTrigger) {
    when (selectedProjectType) {
        ProjectDisplayType.CURRENT -> games.filter { game ->
            val isDevelopingOrReady = game.releaseStatus in listOf(...)
            
            // 已发售但有进行中更新任务的游戏
            val hasActiveUpdateTask = if (game.releaseStatus in listOf(RELEASED, RATED)) {
                val gameRevenue = RevenueManager.getGameRevenue(game.id)
                val updateTask = gameRevenue?.updateTask
                updateTask != null && updateTask.progressPoints < updateTask.requiredPoints
            } else {
                false
            }
            
            isDevelopingOrReady || hasActiveUpdateTask
        }
        ...
    }
}
```

### 2. 增强游戏项目卡片显示
**文件**: `EnhancedGameProjectCard.kt`

#### 2.1 状态标签优化
- **开发中游戏**: 显示"进行中"或"待分配"（绿色）
- **更新中游戏**: 显示"更新中"或"待分配"（蓝色） + 🔄图标

#### 2.2 更新内容列表
有更新任务的游戏会显示蓝色卡片，列出所有更新特征：
```
🔄 更新内容
• 反选
• 新皮肤
• 新道具
...
```

#### 2.3 进度显示
- **开发进度**: 绿色进度条，显示开发完成度
- **更新进度**: 蓝色进度条，显示更新任务完成度（X项内容）

#### 2.4 按钮区域
- **有更新任务**: 显示"一键分配员工"+"查看详细收益报告"两个按钮
- **开发中**: 只显示"一键分配员工"
- **已发售（无更新）**: 只显示"查看详细收益报告"

## 使用流程

1. **发起更新**：在"已发售"标签页查看游戏收益 → 点击"游戏更新" → 选择更新内容 → 点击"开始更新"

2. **分配员工**：游戏自动出现在"当前项目"标签页，状态显示为"🔄 更新中"，点击"一键分配员工"进行员工分配

3. **查看进度**：在项目卡片中查看蓝色更新进度条和更新内容列表

4. **完成更新**：员工每天推进进度，进度达到100%后自动完成更新，游戏销量/注册数得到提升

## 技术细节

### 更新任务数据结构
```kotlin
data class GameUpdateTask(
    val features: List<String>,      // 更新内容列表
    val requiredPoints: Int,         // 需要的总进度点数（每项内容100点）
    val progressPoints: Int = 0      // 当前进度点数
)
```

### 进度推进机制
- 每月结算时，系统自动为有更新任务的游戏推进进度
- 进度增加 = 已分配员工数 × 20（最少10点）
- 进度达到100%时自动应用更新效果

### 更新效果
- **单机游戏**: 销量整体提高5%，历史销量也会回溯提升
- **网络游戏**: 
  - 恢复玩家兴趣值（根据生命周期阶段）
  - 增加10-20%的新注册玩家
  - 销量/活跃度提升

## 界面效果

### 当前项目标签页
```
🎮 项目管理                    📢 宣传中心

[开发新游戏]

当前项目     [下拉选择]  👥 可用员工: 5人

┌─────────────────────────────────┐
│ 游戏名称  🔄 更新中               │
│ 动作 • PC, Android  网络游戏  宣传指数│
│                                  │
│ 🔄 更新内容                       │
│ • 反选                           │
│ • 新皮肤                         │
│ • 新道具                         │
│                                  │
│ 已分配员工 (2人):                │
│ 📋 张三 (程序员)  技能：4级      │
│ 📋 李四 (美术)    技能：3级      │
│                                  │
│ 更新进度 · 3项内容        45%    │
│ ▰▰▰▰▰▰▰▱▱▱▱▱                   │
│                                  │
│ [一键分配员工]                   │
│ [📊 查看详细收益报告]            │
└─────────────────────────────────┘
```

## 修改文件列表
1. `EnhancedProjectManagement.kt` - 项目过滤逻辑
2. `EnhancedGameProjectCard.kt` - 游戏卡片显示逻辑

## 兼容性
- ✅ 与现有开发系统完全兼容
- ✅ 不影响已发售游戏的正常显示
- ✅ 支持实时刷新（refreshTrigger）
- ✅ 支持旧存档（没有更新任务的游戏正常显示）
