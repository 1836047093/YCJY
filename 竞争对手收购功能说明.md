# 竞争对手收购功能说明

## 功能概述

实现了完整的竞争对手收购系统，包含资格检查、实时竞价、AI竞争和收购收益等完整流程。

## 核心机制

### 1. 收购资格条件

玩家需要同时满足以下条件才能发起收购：

- **市值要求**：玩家市值 ≥ 目标公司市值 × 1.5倍
- **资金要求**：玩家资金 ≥ 目标公司市值 × 1.2倍（最低收购价）
- **不能收购自己**：无法收购玩家自己的公司

### 2. 竞价机制

#### 初始出价
- 基础收购价 = 目标市值 × 1.2倍
- 30-50%概率触发其他公司参与竞价

#### AI竞争对手参与条件
- 市值 > 目标市值 × 1.3倍
- 当前出价 < AI的最高出价能力
- 随机选择1-2个符合条件的竞争对手参与

#### AI出价策略
- **出价概率**：60-80%概率继续出价
- **加价幅度**：当前价格 × (1 + 5%-15%)
- **理性上限**：
  - 不超过自身市值的70%（保留运营资金）
  - 不超过目标市值的2.5倍（避免非理性出价）
- **市值越高，越容易出价**：通过加权随机选择出价的AI

#### 玩家加价
- 每次加价10%
- 只有当AI领先时才能加价
- 资金不足时无法加价

### 3. 实时竞价显示

#### 当前出价卡片
- 显示当前最高出价（金色高亮）
- 显示领先者名称（玩家用绿色标识）

#### 竞价记录
- 按时间倒序显示所有出价记录
- 玩家出价显示👤图标和绿色背景
- AI出价显示🏢图标和灰色背景
- 每条记录显示：出价者、金额

#### 操作按钮
- **放弃按钮**：主动退出竞价，AI获胜
- **加价按钮**：出价提高10%
  - 只有非领先方才能加价
  - 资金不足时禁用并显示"资金不足"
  - 领先方显示"等待中..."

### 4. 收购收益

#### 市值增长
- 增加量 = 目标市值 × 60%
- 直接提升玩家市值（用于排行榜和后续收购资格）

#### 粉丝增长
- 增加量 = 目标粉丝 × 40%
- 立即增加到玩家账户

#### 游戏继承
- 继承1-2个评分最高的游戏
- 继承的游戏自动转换为玩家的游戏：
  - 状态：已发售
  - 保留原评分、主题、平台
  - 网游保留活跃玩家数据
  - 单机游戏使用默认价格50元

#### 资金扣除
- 扣除最终成交价格
- 实时更新玩家资金

#### 数据更新
- 被收购公司从竞争对手列表中移除
- 生成收购新闻（显示在动态新闻标签）
- 自动保存存档

## UI设计

### 1. 收购入口
在竞争对手详情对话框右下角添加**"💰 收购"**按钮（红色醒目）

### 2. 资格不符提示
如果不符合收购条件，显示：
- ❌图标
- 具体原因（市值不足/资金不足）
- 需要的数值 vs 当前数值
- 只有关闭按钮

### 3. 竞价进行中界面
```
💰 收购 [公司名]
目标市值: XXX万

─────────────────

┌─ 当前最高出价 ─┐
│ ¥XXX万         │ (金色大字)
│ 领先者：XXX    │ (玩家=绿色, AI=白色)
└─────────────────┘

竞价记录
👤 玩家公司    ¥XXX万  (绿色背景)
🏢 AI公司A     ¥XXX万  (灰色背景)
👤 玩家公司    ¥XXX万  (绿色背景)

[放弃]  [加价至 ¥XXX万]
```

### 4. 结果界面
#### 成功
```
🎉

收购成功！

以 ¥XXX万 成功收购 XXX

收益：
• 市值增加：¥XXX万
• 粉丝增加：XXX
• 继承游戏：X款

[关闭]
```

#### 失败
```
😞

收购失败

XXX 以 ¥XXX万 的价格
成功收购了 XXX

[关闭]
```

## 数值设计

### 收购成本
| 公司类型 | 最低收购价 | 典型最终价 | 理性上限 |
|---------|-----------|-----------|---------|
| 小型公司 (500万市值) | 600万 | 700-800万 | 1250万 |
| 中型公司 (1000万市值) | 1200万 | 1400-1600万 | 2500万 |
| 大型公司 (5000万市值) | 6000万 | 7000-8000万 | 1.25亿 |

### AI出价能力
- **财务保守型**：最多出到自身市值的70%
- **理性上限**：不超过目标市值的2.5倍
- 实际出价范围：最低价 ~ min(AI市值×0.7, 目标市值×2.5)

### 投资回报率
假设收购500万市值的公司：
- 成本：600-800万
- 市值增长：300万（60%）
- 粉丝价值：假设5K粉丝 → 增加2K → 约2万价值
- 继承游戏：1-2款热门游戏（潜在月收入）
- **ROI**：约50-70%（通过游戏收入逐步回本）

## 触发概率

- **无竞争**：50-70%概率无其他公司参与，直接成交
- **有竞争**：30-50%概率触发1-2个AI竞争
- **AI继续出价**：60-80%概率（每轮）
- **预期竞价轮次**：2-5轮

## 技术实现

### 核心文件

#### CompetitorData.kt
- `AcquisitionStatus`：收购资格状态枚举
- `AcquisitionBid`：竞价出价记录
- `AcquisitionResult`：收购结果密封类
- `checkAcquisitionEligibility()`：检查收购资格
- `initiateAcquisition()`：发起收购，返回初始价格和竞争对手
- `processAIBidding()`：处理AI竞价轮次
- `completeAcquisition()`：完成收购，计算收益

#### CompetitorScreen.kt
- `CompetitorDetailDialog`：添加收购按钮
- `AcquisitionDialog`：完整的竞价对话框
  - 资格检查
  - 实时竞价显示
  - AI自动竞价（协程）
  - 玩家加价交互
  - 结果展示
- `BidHistoryItem`：竞价记录项组件

#### MainActivity.kt
- `CompetitorContent`的`onAcquisitionSuccess`回调
- 处理收购后的数据更新：
  - 扣除资金
  - 增加粉丝
  - 移除被收购公司
  - 继承游戏
  - 初始化游戏收益数据
  - 生成收购新闻
  - 保存存档

### 状态管理

使用Compose的`remember`和`mutableStateOf`管理竞价状态：
- `biddingPhase`：竞价阶段（checking, bidding, finished）
- `currentPrice`：当前最高出价
- `currentLeader`：当前领先者
- `biddingHistory`：竞价历史记录
- `canPlayerBid`：玩家是否可以加价
- `showResult`：是否显示结果

### 异步处理

使用`LaunchedEffect`和协程实现：
- 初始化竞价
- AI自动竞价轮次（每轮延迟2秒）
- 玩家加价后触发下一轮AI竞价
- 结果显示延迟

## 游戏策略

### 何时收购
- ✅ 市值远超目标，资金充裕
- ✅ 看中目标的热门游戏（高评分网游/畅销单机）
- ✅ 目标粉丝多，能快速提升影响力
- ❌ 市值刚好达标，容易在竞价中被超越
- ❌ 资金紧张，影响后续运营

### 竞价策略
- **快速出价**：连续加价吓退AI（消耗资金）
- **等待观望**：让AI先出价，评估是否值得跟进
- **适时放弃**：价格超过价值时主动退出
- **财务规划**：预留足够资金应对竞价升级

### 收购目标选择
1. **高粉丝公司**：快速提升市值和影响力
2. **热门游戏**：继承高评分网游，获得稳定收入流
3. **畅销单机**：继承销量好的单机游戏
4. **成长型公司**：虽然当前规模小，但游戏质量高

## 平衡性设计

### 防止滥用
- 市值门槛：必须是目标的1.5倍，防止弱小公司收购大公司
- 资金要求：最低1.2倍市值，确保有收购能力
- AI竞争：30-50%概率触发，增加不确定性
- 理性上限：防止无限加价
- 收益限制：只获得60%市值和40%粉丝，非100%

### 激励设计
- 继承热门游戏：立即获得收入来源
- 市值提升：有助于后续更大的收购
- 粉丝增长：提升排行榜排名
- 新闻曝光：增加游戏的知名度

### 风险管理
- 竞价失败：白白消耗时间和机会成本
- 资金占用：收购后现金流紧张
- AI竞争：可能抬高价格，降低ROI
- 继承游戏质量：随机1-2款，不一定都是最好的

## 示例场景

### 场景1：顺利收购小公司
1. 玩家市值2000万，资金1500万
2. 看中"梦境互娱"（市值500万，粉丝8K，1款8.5分网游）
3. 点击收购，通过资格检查
4. 初始出价600万，无AI竞争
5. 直接成交！
6. 收益：市值+300万，粉丝+3.2K，继承1款网游
7. 成本：600万资金

### 场景2：激烈竞价
1. 玩家市值5000万，资金3000万
2. 看中"星尘枢纽"（市值2000万，粉丝50K，2款高分游戏）
3. 点击收购，通过资格检查
4. 初始出价2400万，"泰坦互娱"参与竞价
5. 竞价记录：
   - 玩家：2400万
   - 泰坦：2640万 (+10%)
   - 玩家：2904万 (+10%)
   - 泰坦：3165万 (+9%)
   - 玩家放弃（太贵了！）
6. 泰坦获胜，玩家失败
7. 无收益，浪费时间

### 场景3：策略性收购
1. 玩家市值8000万，资金5000万
2. 同时考虑：
   - A公司：市值1000万，1款9.0分网游（月收入预估50万）
   - B公司：市值3000万，粉丝100K，游戏一般
3. 选择收购A公司（性价比高）
4. 出价1200万，无竞争
5. 收益：继承1款顶级网游，每月净赚50万
6. **12个月回本**，之后持续盈利

## 未来扩展

可能的扩展方向：
- [ ] 添加尽职调查系统（查看目标公司详细财务数据）
- [ ] 收购前谈判机制（降低初始价格）
- [ ] 分期付款选项（降低一次性资金压力）
- [ ] 被收购风险（AI也可能收购玩家）
- [ ] 收购后整合期（游戏收入有临时降低）
- [ ] 反垄断限制（市值过高后限制收购）

## 总结

竞争对手收购功能为游戏增加了：
- ✅ 策略深度：评估目标、资金规划、竞价决策
- ✅ 紧张刺激：实时竞价、AI竞争、不确定性
- ✅ 成长路径：通过收购快速扩张，获得优质资产
- ✅ 经济循环：资金投入 → 获得游戏 → 持续收益 → 再投资
- ✅ 风险管理：资金占用、竞价失败、ROI评估

这是一个平衡策略性和娱乐性的高级功能，适合中后期玩家使用！
