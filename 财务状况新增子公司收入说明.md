# 财务状况新增子公司收入说明

## 功能描述

在**公司概览 → 财务状况**界面中，新增"子公司收入"显示项，将收入分为三个部分：
1. **单机收入**：自研单机游戏的收入
2. **网游收入**：自研网络游戏的收入
3. **子公司收入**：从竞争对手收购来的游戏收入（继承游戏）
4. **总收入**：三项收入的总和

## 实现逻辑

### 游戏分类标识

通过游戏ID判断是否为子公司游戏：
- **自研游戏**：普通ID（如 "game_123"）
- **子公司游戏**：ID以 `inherited_` 开头（如 "inherited_game_456"）

### 收入计算

```kotlin
// 自研单机游戏收入
filter { it.businessModel == BusinessModel.SINGLE_PLAYER && !it.id.startsWith("inherited_") }

// 自研网游收入
filter { it.businessModel == BusinessModel.ONLINE_GAME && !it.id.startsWith("inherited_") }

// 子公司游戏收入（包含单机和网游）
filter { it.id.startsWith("inherited_") }
```

### 年份筛选

所有收入都支持按年份筛选，使用 `calculateGameYear()` 函数根据游戏上线日期和记录日期计算游戏内年份。

## UI展示

```
财务状况                    第1年 ▼

单机收入              ¥123,456.78
网游收入              ¥234,567.89
子公司收入            ¥0.00
总收入                ¥358,024.67
```

## 使用场景

### 场景1：收购前
玩家未收购任何竞争对手公司：
- 单机收入：¥50,000
- 网游收入：¥80,000
- 子公司收入：¥0.00（显示但为0）
- 总收入：¥130,000

### 场景2：收购后
玩家收购了一家公司，继承了2款游戏：
- 单机收入：¥50,000（自研）
- 网游收入：¥80,000（自研）
- 子公司收入：¥150,000（继承的2款游戏）
- 总收入：¥280,000

## 优势

✅ **清晰区分**：自研游戏和收购游戏的收入一目了然  
✅ **运营分析**：可以评估收购是否成功，子公司游戏是否盈利  
✅ **战略决策**：帮助玩家判断是否继续收购竞争对手  
✅ **完整统计**：总收入包含所有来源，数据准确  

## 相关功能

- **项目管理 → 子公司**：查看所有继承游戏列表
- **竞争对手 → 收购**：收购竞争对手公司获取游戏
- **继承游戏标识**：游戏卡片上会显示"继承自XXX公司"

## 技术细节

**修改文件**：
- `MainActivity.kt`：财务状况计算逻辑（3126-3211行）

**核心改动**：
1. 单机收入和网游收入添加 `!it.id.startsWith("inherited_")` 过滤
2. 新增子公司收入计算：`filter { it.id.startsWith("inherited_") }`
3. 总收入公式更新：`singlePlayerRevenue + onlineGameRevenue + subsidiaryRevenue`
4. UI显示新增"子公司收入"项

## 向后兼容

✅ 完全向后兼容：
- 未收购过公司的存档：子公司收入显示为¥0.00
- 已收购公司的存档：自动计算继承游戏的收入

## 修改日期

2025-01-26
