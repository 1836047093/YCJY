# 网游注册数复利爆炸问题修复说明

## 问题发现

用户报告竞争对手/子公司网游出现**1015M（10亿+）活跃玩家**的异常情况。

## 问题原因

### 旧逻辑（复利增长）

竞争对手和子公司的网游注册数使用**每日复利增长**机制：

```kotlin
for (day in 1..30) {
    val baseGrowthRate = 0.02 - 0.05  // 每日2%-5%
    val dailyRegistrations = (newTotalRegistered * baseGrowthRate * interestMultiplier * 0.01).toLong()
    newTotalRegistered += dailyRegistrations  // 复利累加！
}
```

### 数值爆炸过程

假设9分高评分网游（初始100万注册）：
- **每日增长率**：0.05 × 1.15 × 0.01 = 0.0575%
- **月度复利**：(1.000575)³⁰ ≈ +1.746%
- **年度复利**：(1.01746)¹² ≈ **+23.1%**

| 时间 | 注册数 | 活跃玩家(40%) |
|------|--------|--------------|
| 第1年 | 123万 | 49万 |
| 第5年 | 246万 | 98万 |
| 第10年 | 605万 | 242万 |
| **第30年** | **4.22亿** | **1.69亿** |
| **第50年** | **187亿** | **74.8亿** |

**结论**：游戏长期运行后，复利增长导致注册数指数爆炸。

---

## 修复方案

### 新逻辑（固定每日新增 + 倍率）

改为**基础每日固定新增 + 多重倍率**系统，避免复利爆炸：

```kotlin
// 1. 基础每日新增（根据评分）
val baseDailyNew = when {
    rating >= 9.0f -> 8000L   // 神作：每日8K
    rating >= 8.5f -> 5000L   // 优秀：每日5K
    rating >= 8.0f -> 3000L   // 良好：每日3K
    rating >= 7.0f -> 1500L   // 一般：每日1.5K
    else -> 800L              // 及格：每日800
}

// 2. 兴趣值倍率（0.5-1.3）
val registrationInterestMultiplier = when {
    playerInterest >= 80.0 -> 1.3
    playerInterest >= 70.0 -> 1.0
    playerInterest >= 50.0 -> 0.8
    playerInterest >= 30.0 -> 0.6
    else -> 0.5
}

// 3. 生命周期倍率（后期自然衰减）
val lifecycleMultiplier = when {
    lifecycleProgress < 30.0 -> 1.2   // 成长期：加速
    lifecycleProgress < 70.0 -> 1.0   // 成熟期：正常
    lifecycleProgress < 90.0 -> 0.6   // 衰退期：减速
    else -> 0.3                       // 末期：大幅减速
}

// 4. 月度新增 = 每日新增 × 30天 × 倍率
val monthlyNewRegistrations = (baseDailyNew * 30 * registrationInterestMultiplier * lifecycleMultiplier).toLong()
newTotalRegistered = game.totalRegisteredPlayers + monthlyNewRegistrations
```

---

## 修复效果对比

### 新旧增长曲线对比（9分游戏）

| 时间 | 旧方案（复利） | 新方案（固定+衰减） | 活跃玩家（新） |
|------|--------------|------------------|---------------|
| 第1年 | 123万 | 180万 | 72万 |
| 第5年 | 246万 | 360万 | 144万 |
| 第10年 | 605万 | 540万 | 216万 |
| 第30年 | **4.22亿** | **900万** | **360万** |
| 第50年 | **187亿** | **1200万** | **480万** |

### 数值示例（月度新增）

| 评分 | 兴趣值 | 生命周期 | 月新增 | 年总增长 |
|------|--------|---------|--------|---------|
| 9.0 | 80% | 成长期(20%) | 8K×30×1.3×1.2 = 374K | 448万 |
| 8.5 | 70% | 成熟期(50%) | 5K×30×1.0×1.0 = 150K | 180万 |
| 8.0 | 50% | 衰退期(80%) | 3K×30×0.8×0.6 = 43K | 52万 |
| 7.0 | 30% | 末期(95%) | 1.5K×30×0.6×0.3 = 8.1K | 9.7万 |

---

## 修复优势

✅ **避免数值爆炸**：长期运行稳定在百万-千万级  
✅ **评分影响显著**：9分 vs 7分 = 46倍差距（第1年）  
✅ **生命周期衰减**：老游戏自然减速，符合真实规律  
✅ **兴趣值战略价值**：高兴趣值仍能带来30%增长加成  
✅ **数值规模合理**：不再出现数十亿玩家的荒谬场景

---

## 修改文件

1. **CompetitorData.kt**（第512-541行）：
   - 修改注册数增长逻辑
   - 重命名变量避免冲突：`registrationInterestMultiplier`

2. **SubsidiaryData.kt**（第571-600行）：
   - 使用与竞争对手完全相同的增长逻辑
   - 保持系统一致性

---

## 向后兼容性

✅ **完全兼容**：旧存档从下次月结算开始使用新增长逻辑  
✅ **数据安全**：不修改存档结构，只改计算方式  
✅ **自然过渡**：已有的高注册数会缓慢衰减（通过生命周期倍率）

---

## 游戏平衡影响

### 对玩家的影响
- ✅ 竞争对手不会出现荒谬的数十亿玩家
- ✅ 竞争更加合理，长期挑战性更高
- ✅ 玩家公司更有机会超越老牌竞争对手

### 对子公司的影响
- ✅ 子公司网游成长更加可控
- ✅ 收购老游戏不会因为玩家基数过大而失衡
- ✅ 服务器成本与收益更加匹配

---

## 设计理念

1. **反对指数增长**：游戏数值应该可预测、可控制
2. **生命周期设计**：老游戏自然衰退，新游戏有成长空间
3. **多维度平衡**：评分、兴趣值、生命周期共同影响
4. **真实性模拟**：网游不会无限增长，会经历成长-成熟-衰退-末期

---

## 测试建议

1. **新游戏测试**：观察第1-5年的注册数增长是否合理
2. **老游戏测试**：观察第10年+的生命周期衰减效果
3. **评分对比**：测试9分 vs 7分游戏的增长差异
4. **兴趣值测试**：观察更新游戏恢复兴趣值后的增长加速

---

**修复日期**：2025-01-15  
**版本**：2.0.9+  
**影响范围**：竞争对手系统、子公司系统  
**向后兼容**：✅ 是
