# 游戏社区功能说明

## 功能概述

为已发售游戏添加了完整的**游戏社区系统**，玩家可以在社区中查看游戏的更新历史、更新公告以及智能生成的玩家评论，并可以为评论点赞。

## 核心功能

### 1. 更新公告输入系统

**触发时机**：点击"开始更新"按钮后

**功能特性**：
- 居中弹出公告输入对话框
- 玩家可以自定义输入更新公告
- 如果不输入，系统自动生成默认公告
- 默认公告格式：`本次更新内容包括：{更新内容列表}，感谢各位玩家的支持！`

**UI设计**：
- 显示本次更新内容列表
- 多行文本输入框（120-180dp高度）
- 默认公告预览卡片
- 三个按钮：取消、使用默认、确认发布/跳过

### 2. 游戏社区对话框

**入口位置**：已发售游戏卡片红框处（图2位置）

**显示条件**：
- 游戏已发售（RELEASED或RATED状态）
- 游戏有更新历史记录时显示"游戏社区"按钮
- 没有更新历史时只显示"收益报告"按钮

**UI布局**：
- 按钮：收益报告（绿色） + 游戏社区（蓝色），各占50%宽度
- 颜色：收益报告 `Color(0xFF10B981)`，游戏社区 `Color(0xFF3B82F6)`

### 3. 智能评论生成系统

**评论生成规则**：

1. **评论数量**：每次更新随机生成5-10条评论

2. **玩家昵称**：从40个昵称库中随机选择 + 4位随机数字
   - 示例：游戏狂热者1234、夜猫子玩家5678

3. **评论内容**：根据更新内容智能匹配
   - **新皮肤**：10种评论模板（如"新皮肤太好看了！必须买买买！"）
   - **新道具**：10种评论模板
   - **新装备**：10种评论模板
   - **新赛季**：10种评论模板
   - **新角色**：10种评论模板（如"又出新角色，上个角色还没玩明白"）
   - **新地图**：10种评论模板（如"终于出新地图了，又有新图玩了"）
   - **新模式**：10种评论模板
   - **新武器**：10种评论模板
   - 其他类型：通用评论

4. **点赞数**：
   - 90%概率：普通评论，0-100赞
   - 10%概率：热门评论，200-500赞
   - 评论自动按点赞数降序排列

### 4. 游戏社区UI界面

**整体设计**：
- 深色主题 `Color(0xFF1E293B)` 护眼背景
- 全屏对话框（95%宽，90%高）
- 标题：🎮 游戏社区 + 游戏名称

**更新记录卡片**（每个更新一张卡片）：

1. **更新标题**：
   - 左侧：V{更新序号}.0 更新（蓝色）
   - 右侧：更新日期（年月日）

2. **更新内容卡片**（灰色背景）：
   - 标题：📋 更新内容（黄色）
   - 列表：每项前缀 `•`

3. **更新公告卡片**（灰色背景）：
   - 标题：📢 更新公告（绿色）
   - 内容：玩家输入或默认公告

4. **玩家评论区**：
   - 标题：💬 玩家评论 ({评论数})
   - 每条评论一个卡片

**评论卡片设计**：
- 左侧：圆形头像（显示昵称首字母）
- 中间：玩家昵称（浅蓝色）+ 评论内容
- 右侧：点赞按钮 + 点赞数
- 点赞后图标变红色实心，数字+1
- 每条评论只能点赞一次

**空状态显示**：
- 图标：📭（48sp）
- 文字：暂无更新记录
- 提示：游戏更新后将在这里显示

### 5. 数据存储

**新增数据模型**：

```kotlin
// 游戏日期
data class GameDate(
    val year: Int,
    val month: Int,
    val day: Int
)

// 玩家评论
data class PlayerComment(
    val id: String,          // 唯一ID
    val playerName: String,  // 玩家昵称
    val content: String,     // 评论内容
    var likes: Int,          // 点赞数
    var isLikedByUser: Boolean = false
)

// 游戏更新记录
data class GameUpdate(
    val updateNumber: Int,        // 第几次更新
    val updateDate: GameDate,     // 更新日期
    val updateContent: List<String>,  // 更新内容
    val announcement: String,     // 更新公告
    val comments: List<PlayerComment> = emptyList()
)
```

**Game数据类新增字段**：
```kotlin
val updateHistory: List<GameUpdate> = emptyList()
```

**GameUpdateTask新增字段**：
```kotlin
val announcement: String = ""
```

## 工作流程

### 更新流程

1. **玩家点击"开始更新"**
   - 弹出选择更新内容对话框
   - 玩家选择更新内容

2. **点击"开始更新"按钮**
   - 弹出更新公告输入对话框
   - 玩家可输入自定义公告或使用默认公告

3. **确认发布**
   - 扣除更新费用
   - 创建更新任务（包含更新内容和公告）
   - 关闭对话框

4. **更新进行中**
   - 玩家分配员工处理更新任务
   - 每日推进更新进度

5. **更新完成**
   - 自动创建GameUpdate记录
   - 生成5-10条随机玩家评论
   - 添加到game.updateHistory
   - 版本号+0.1

### 查看社区流程

1. **玩家打开游戏卡片**
   - 已发售且有更新历史时显示"游戏社区"按钮

2. **点击游戏社区按钮**
   - 打开游戏社区对话框
   - 按时间倒序显示所有更新记录

3. **浏览评论**
   - 查看各个更新的玩家评论
   - 评论按点赞数降序排列

4. **点赞评论**
   - 点击点赞按钮
   - 图标变红，数字+1
   - 每条评论只能点赞一次
   - 点赞状态保存到存档

## 文件修改清单

### 新增文件

1. **CommentGenerator.kt**
   - 智能评论生成器
   - 包含40个玩家昵称库
   - 包含14种更新类型的评论模板（每种10条）
   - generateComments()：生成评论
   - generateDefaultAnnouncement()：生成默认公告

2. **GameCommunityDialog.kt**
   - 游戏社区UI对话框
   - UpdateCard：更新记录卡片
   - CommentItem：评论项组件
   - 支持评论点赞功能

### 修改文件

1. **GameData.kt**
   - 新增GameDate数据类
   - 新增PlayerComment数据类
   - 新增GameUpdate数据类
   - Game.updateHistory字段

2. **GameRevenueData.kt**
   - GameUpdateTask新增announcement字段
   - createUpdateTask()增加announcement参数

3. **GameRevenueDialog.kt**
   - UpdateFeatureDialog修改onConfirm签名
   - 新增AnnouncementInputDialog组件
   - 点击"开始更新"后显示公告输入对话框

4. **EnhancedGameProjectCard.kt**
   - 已发售游戏按钮区域重构
   - 有更新历史时显示并排按钮：收益报告 + 游戏社区
   - 没有更新历史时只显示收益报告按钮
   - 集成GameCommunityDialog
   - 实现评论点赞功能

5. **MainActivity.kt**
   - 更新完成时创建GameUpdate记录
   - 调用CommentGenerator生成评论
   - 添加到game.updateHistory
   - 存档系统自动保存updateHistory

## 设计亮点

### 1. 智能匹配评论

根据更新内容类型自动匹配对应的评论模板，例如：
- 更新"新地图" → 评论"终于出新地图了，又有新图玩了"
- 更新"新角色" → 评论"又出新角色，上个角色还没玩明白"

### 2. 真实的社区氛围

- 多样化的玩家昵称（40种基础昵称 + 随机数字）
- 点赞数符合真实分布（90%普通评论，10%热门评论）
- 评论按点赞数排序，热门评论在前

### 3. 渐进式显示

- 游戏首次发售时不显示社区按钮
- 有更新后才出现社区按钮
- 更新越多，社区内容越丰富

### 4. 良好的用户体验

- 公告可选可不填，降低操作门槛
- 默认公告智能生成，省时省力
- 评论点赞有视觉反馈（图标变色、数字增加）
- 点赞状态持久化保存

## 向后兼容

- 所有新增字段都有默认值
- 旧存档自动兼容，updateHistory默认为空列表
- 旧游戏可以正常更新并生成社区内容

## 使用场景

1. **查看游戏更新历史**
   - 玩家可以回顾游戏的所有更新
   - 了解每次更新的具体内容和公告

2. **了解玩家反馈**
   - 查看玩家对更新的评价
   - 了解哪些内容受欢迎（高点赞评论）

3. **增强游戏沉浸感**
   - 模拟真实游戏社区
   - 提升游戏代入感和真实感

## 技术特点

- **完全离线**：所有评论本地生成，无需网络
- **高性能**：评论生成速度快（<100ms）
- **低内存**：使用模板库，不占用大量内存
- **可扩展**：易于添加新的评论类型和模板
- **数据安全**：所有数据保存在本地存档

## 未来扩展方向

1. 更多评论模板（每种类型增加到20-30条）
2. 根据游戏评分调整评论倾向（高分游戏正面评论多）
3. 添加玩家回复功能（官方回复玩家评论）
4. 社区统计数据（总评论数、平均点赞数等）
5. 热门评论高亮显示
