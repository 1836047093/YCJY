# å…‘æ¢ç ç®¡ç†ç³»ç»Ÿå®Œæ•´æµç¨‹è¯´æ˜

## âœ… æ‚¨çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼

æ‚¨æè¿°çš„æµç¨‹æ­£æ˜¯æ ‡å‡†çš„å…‘æ¢ç ç®¡ç†ç³»ç»Ÿï¼š

```
ç®¡ç†åå°ç”Ÿæˆå…‘æ¢ç  â†’ åŒæ­¥åˆ°Firebase â†’ ç©å®¶å…‘æ¢ â†’ è®°å½•åˆ°Firestore
```

## ğŸ“Š å®Œæ•´æ•°æ®æµç¨‹

### 1. ç®¡ç†åå°ç”Ÿæˆå…‘æ¢ç 

**æ–¹å¼Aï¼šåœ¨ç®¡ç†åå°æ‰‹åŠ¨ç”Ÿæˆ**
- ç®¡ç†å‘˜åœ¨åå°è¾“å…¥å…‘æ¢ç ï¼ˆå¦‚ï¼š`VIP2025`ï¼‰
- é€‰æ‹©å…‘æ¢ç ç±»å‹ï¼ˆæ”¯æŒè€…ã€GMã€ç‰¹æ®Šç­‰ï¼‰
- ç‚¹å‡»"ç”Ÿæˆå¹¶åŒæ­¥"

**æ–¹å¼Bï¼šæ‰¹é‡ç”Ÿæˆ**
- ç®¡ç†åå°æ‰¹é‡ç”Ÿæˆï¼ˆå¦‚ï¼š`SUPPORTER001-150`ï¼‰
- ä¸€é”®åŒæ­¥åˆ°Firebase

### 2. åŒæ­¥åˆ°Firebase

ä½¿ç”¨ `createRedeemCode()` æˆ– `createRedeemCodesBatch()` å‡½æ•°ï¼š

```kotlin
// å•ä¸ªå…‘æ¢ç 
FirebaseRedeemCodeManager.createRedeemCode(
    code = "VIP2025",
    codeType = "supporter",
    maxUses = 1
)

// æ‰¹é‡å…‘æ¢ç 
val codes = listOf("VIP001", "VIP002", "VIP003")
FirebaseRedeemCodeManager.createRedeemCodesBatch(
    codes = codes,
    codeType = "supporter",
    maxUses = 1
)
```

**Firestore æ•°æ®ç»“æ„ï¼š**
```
redeem_codes/
  â”œâ”€â”€ VIP2025/
  â”‚   â”œâ”€â”€ code: "VIP2025"
  â”‚   â”œâ”€â”€ type: "supporter"
  â”‚   â”œâ”€â”€ isValid: true
  â”‚   â”œâ”€â”€ maxUses: 1
  â”‚   â”œâ”€â”€ usedCount: 0
  â”‚   â”œâ”€â”€ usedByUserId: null
  â”‚   â”œâ”€â”€ usedAt: null
  â”‚   â””â”€â”€ createdAt: "2025-11-07T01:00:00Z"
  â””â”€â”€ ...
```

### 3. ç©å®¶åœ¨æ¸¸æˆä¸­å…‘æ¢

ç©å®¶è¾“å…¥å…‘æ¢ç åï¼Œç³»ç»Ÿä¼šï¼š

1. **éªŒè¯å…‘æ¢ç æ ¼å¼**ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ ¼å¼
2. **æ£€æŸ¥å…¨å±€çŠ¶æ€**ï¼šæ£€æŸ¥æ˜¯å¦å·²è¢«å…¶ä»–ç”¨æˆ·ä½¿ç”¨
3. **æ£€æŸ¥ç”¨æˆ·çŠ¶æ€**ï¼šæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²ä½¿ç”¨è¿‡
4. **æ‰§è¡Œå…‘æ¢**ï¼šä½¿ç”¨äº‹åŠ¡æ›´æ–°æ•°æ®

### 4. è®°å½•åˆ°Firestore

å…‘æ¢æˆåŠŸåï¼ŒFirestore ä¼šè‡ªåŠ¨æ›´æ–°ï¼š

**å…¨å±€å…‘æ¢ç è®°å½•ï¼ˆ`redeem_codes` é›†åˆï¼‰ï¼š**
```json
{
  "code": "VIP2025",
  "type": "supporter",
  "isValid": true,
  "maxUses": 1,
  "usedCount": 1,                    // âœ… å·²ä½¿ç”¨
  "usedByUserId": "mT/ACJluBZGQowXTWMmnKg==",  // âœ… ä½¿ç”¨è€…ID
  "usedAt": "2025-11-07T01:20:59Z",  // âœ… ä½¿ç”¨æ—¶é—´
  "createdAt": "2025-11-07T01:00:00Z"
}
```

**ç”¨æˆ·å…‘æ¢è®°å½•ï¼ˆ`user_redeem_codes` é›†åˆï¼‰ï¼š**
```json
{
  "userId": "mT/ACJluBZGQowXTWMmnKg==",
  "usedCodes": ["VIP2025"],
  "gmModeUnlocked": false,
  "supporterUnlocked": true,
  "lastUpdated": "2025-11-07T01:20:59Z"
}
```

## ğŸ” åœ¨ç®¡ç†åå°æŸ¥çœ‹å…‘æ¢è®°å½•

### æ–¹å¼1ï¼šFirebase Consoleï¼ˆæ¨èï¼‰

1. æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
2. è¿›å…¥ **Firestore Database**
3. æŸ¥çœ‹ `redeem_codes` é›†åˆ
4. ç­›é€‰æ¡ä»¶ï¼š
   - `usedCount > 0`ï¼šæŸ¥çœ‹å·²ä½¿ç”¨çš„å…‘æ¢ç 
   - `usedCount = 0`ï¼šæŸ¥çœ‹æœªä½¿ç”¨çš„å…‘æ¢ç 
   - `type = "supporter"`ï¼šæŸ¥çœ‹æ”¯æŒè€…å…‘æ¢ç 

### æ–¹å¼2ï¼šä»£ç æŸ¥è¯¢

```kotlin
// è·å–æ‰€æœ‰å·²ä½¿ç”¨çš„å…‘æ¢ç 
val usedCodes = FirebaseRedeemCodeManager.getUsedRedeemCodes()
usedCodes.forEach { code ->
    println("å…‘æ¢ç : ${code.code}")
    println("ä½¿ç”¨è€…: ${code.usedByUserId}")
    println("ä½¿ç”¨æ—¶é—´: ${code.usedAt}")
    println("---")
}

// æŸ¥è¯¢ç‰¹å®šå…‘æ¢ç 
val records = FirebaseRedeemCodeManager.getRedeemCodeRecords("VIP2025")
```

## ğŸ¯ ç®¡ç†åå°åŠŸèƒ½å»ºè®®

### æ ¸å¿ƒåŠŸèƒ½

1. **ç”Ÿæˆå…‘æ¢ç **
   - å•ä¸ªç”Ÿæˆ
   - æ‰¹é‡ç”Ÿæˆï¼ˆæŒ‡å®šæ•°é‡ã€å‰ç¼€ã€ç±»å‹ï¼‰
   - å¯¼å…¥CSVæ–‡ä»¶

2. **åŒæ­¥åˆ°Firebase**
   - ä¸€é”®åŒæ­¥æ‰€æœ‰ç”Ÿæˆçš„å…‘æ¢ç 
   - æ˜¾ç¤ºåŒæ­¥è¿›åº¦å’Œç»“æœ

3. **æŸ¥çœ‹å…‘æ¢è®°å½•**
   - æ‰€æœ‰å…‘æ¢ç åˆ—è¡¨ï¼ˆå·²ç”¨/æœªç”¨ï¼‰
   - å…‘æ¢ç è¯¦æƒ…ï¼ˆä½¿ç”¨è€…ã€æ—¶é—´ï¼‰
   - ç”¨æˆ·å…‘æ¢å†å²

4. **ç»Ÿè®¡åˆ†æ**
   - å…‘æ¢ç ä½¿ç”¨ç‡
   - ç”¨æˆ·åˆ†å¸ƒ
   - æ—¶é—´è¶‹åŠ¿

### ç®¡ç†åå°å®ç°æ–¹å¼

**é€‰é¡¹1ï¼šWebç®¡ç†åå°ï¼ˆæ¨èï¼‰**
- ä½¿ç”¨ Firebase Admin SDK
- å¯ä»¥ç›´æ¥æ“ä½œ Firestore
- ä¸éœ€è¦é€šè¿‡æ¸¸æˆå®¢æˆ·ç«¯

**é€‰é¡¹2ï¼šæ¸¸æˆå†…ç®¡ç†åŠŸèƒ½**
- åœ¨æ¸¸æˆä¸­æ·»åŠ GMå·¥å…·
- ä½¿ç”¨ `createRedeemCode()` å‡½æ•°
- é€‚åˆå°è§„æ¨¡ç®¡ç†

## ğŸ“ å®Œæ•´ç¤ºä¾‹ä»£ç 

### ç®¡ç†åå°åŒæ­¥å…‘æ¢ç 

```kotlin
// å‡è®¾ç®¡ç†åå°ç”Ÿæˆäº†è¿™äº›å…‘æ¢ç 
val newCodes = listOf(
    "VIP2025",
    "SUPPORTER151",
    "SUPPORTER152",
    "SPECIAL001"
)

// æ‰¹é‡åŒæ­¥åˆ°Firebase
lifecycleScope.launch {
    val count = FirebaseRedeemCodeManager.createRedeemCodesBatch(
        codes = newCodes,
        codeType = "supporter",
        maxUses = 1
    )
    Log.d("Admin", "æˆåŠŸåŒæ­¥ $count ä¸ªå…‘æ¢ç ")
}
```

### æŸ¥çœ‹å…‘æ¢è®°å½•

```kotlin
// è·å–æ‰€æœ‰å·²ä½¿ç”¨çš„å…‘æ¢ç 
lifecycleScope.launch {
    val usedCodes = FirebaseRedeemCodeManager.getUsedRedeemCodes()
    
    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    Log.d("Admin", "å·²ä½¿ç”¨å…‘æ¢ç æ•°é‡: ${usedCodes.size}")
    
    // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
    usedCodes.forEach { code ->
        Log.d("Admin", """
            å…‘æ¢ç : ${code.code}
            ä½¿ç”¨è€…: ${code.usedByUserId}
            ä½¿ç”¨æ—¶é—´: ${code.usedAt}
            ç±»å‹: ${code.type}
        """.trimIndent())
    }
}
```

## âœ… æ€»ç»“

æ‚¨çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼å½“å‰å®ç°å·²ç»æ”¯æŒï¼š

1. âœ… **ç”Ÿæˆå…‘æ¢ç **ï¼š`createRedeemCode()` / `createRedeemCodesBatch()`
2. âœ… **åŒæ­¥åˆ°Firebase**ï¼šè‡ªåŠ¨ä¿å­˜åˆ° `redeem_codes` é›†åˆ
3. âœ… **ç©å®¶å…‘æ¢**ï¼šè‡ªåŠ¨éªŒè¯å’Œè®°å½•
4. âœ… **è®°å½•è¿½è¸ª**ï¼šè®°å½•ç”¨æˆ·IDã€å…‘æ¢ç ã€ä½¿ç”¨æ—¶é—´
5. âœ… **æŸ¥è¯¢åŠŸèƒ½**ï¼š`getUsedRedeemCodes()` / `getRedeemCodeRecords()`

**ä¸‹ä¸€æ­¥ï¼š**
- å¼€å‘Webç®¡ç†åå°ï¼ˆä½¿ç”¨Firebase Admin SDKï¼‰
- æˆ–åœ¨æ¸¸æˆä¸­æ·»åŠ GMå·¥å…·ç•Œé¢
- ä½¿ç”¨ä¸Šè¿°å‡½æ•°å®ç°å®Œæ•´çš„å…‘æ¢ç ç®¡ç†æµç¨‹

