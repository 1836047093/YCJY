# 员工解雇赔偿功能说明

## 功能概述
实现了员工解雇时的赔偿金计算功能，按照**2N+1**公式进行赔偿。

## 赔偿计算公式

### 基本公式
**赔偿金额 = 月薪 × (2N + 1)**

其中：
- **N** = 工作年数（向上取整）
- **月薪** = 员工当前月薪
- **工作年数** = 从入职日期到当前日期的工作年数，不满1年按1年计算

### 计算示例

#### 示例1：工作2年8个月
- 员工月薪：¥8,000
- 工作时长：2年8个月
- 工作年数N（向上取整）：3年
- 赔偿月数：2×3+1 = 7个月
- **赔偿金额：¥8,000 × 7 = ¥56,000**

#### 示例2：工作1年3个月
- 员工月薪：¥10,000
- 工作时长：1年3个月
- 工作年数N（向上取整）：2年
- 赔偿月数：2×2+1 = 5个月
- **赔偿金额：¥10,000 × 5 = ¥50,000**

#### 示例3：工作6个月
- 员工月薪：¥6,000
- 工作时长：6个月
- 工作年数N（向上取整）：1年
- 赔偿月数：2×1+1 = 3个月
- **赔偿金额：¥6,000 × 3 = ¥18,000**

## 核心功能实现

### 1. Employee数据类扩展
**文件**：`GameData.kt`

#### 新增字段
```kotlin
val hireYear: Int = 1   // 入职年份
val hireMonth: Int = 1  // 入职月份
val hireDay: Int = 1    // 入职日期
```

#### 新增方法

##### calculateWorkMonths()
计算员工工作的总月数（向上取整）
- 参数：当前游戏年月日
- 返回：工作总月数
- 示例：入职1年1月15日，当前3年10月20日 = 33个月

##### calculateSeverancePay()
计算解雇赔偿金额（2N+1公式）
- 参数：当前游戏年月日
- 返回：赔偿金额
- 逻辑：
  1. 计算工作月数
  2. 向上取整得到工作年数N
  3. 计算赔偿月数 = 2N+1
  4. 赔偿金额 = 月薪 × 赔偿月数

### 2. 解雇对话框UI优化
**文件**：`EmployeeManagementContent.kt`

#### EnhancedFireDialog增强
新增参数：
- `currentYear`：当前游戏年份
- `currentMonth`：当前游戏月份
- `currentDay`：当前游戏日期
- `currentMoney`：当前资金

#### 显示内容
1. **赔偿详情卡片**
   - 月薪
   - 工作时长（年月显示 + 总月数）
   - 赔偿公式（2N+1 = X个月工资）
   - 赔偿金额（红色醒目显示）

2. **资金不足警告**
   - 当资金不足以支付赔偿时显示红色警告
   - 提示："资金不足，解雇后将负债！"

3. **操作确认**
   - 取消按钮
   - 确认解雇按钮
   - 警告：此操作无法撤销

### 3. 解雇逻辑更新
**文件**：`EmployeeManagementContent.kt`

#### 解雇流程
```kotlin
onConfirm = {
    // 1. 计算赔偿金额
    val severancePay = employee.calculateSeverancePay(...)
    
    // 2. 扣除赔偿金额
    onMoneyUpdate(money - severancePay)
    
    // 3. 移除员工
    val updatedEmployees = allEmployees.filter { it.id != employee.id }
    onEmployeesUpdate(updatedEmployees)
    
    // 4. 关闭对话框
    showFireDialog = false
}
```

### 4. 招聘员工自动记录入职日期
**文件**：`TalentCandidate.kt`, `EmployeeManagementContent.kt`, `RecruitmentService.kt`

#### TalentCandidate.toEmployee()更新
新增参数：
- `hireYear`：入职年份
- `hireMonth`：入职月份
- `hireDay`：入职日期

#### 招聘时自动记录
```kotlin
val newEmployee = candidate.toEmployee(
    newId = generateNewId(),
    hireYear = currentYear,
    hireMonth = currentMonth,
    hireDay = currentDay
)
```

### 5. 创始人员工入职日期
**文件**：`GameData.kt`, `MainActivity.kt`

#### Founder.toEmployee()更新
- 默认入职日期：1年1月1日（游戏开始日期）
- 创始人从公司创立之日就在职

```kotlin
val founderAsEmployee = founder.toEmployee(
    hireYear = 1,
    hireMonth = 1,
    hireDay = 1
)
```

## 修改文件列表

1. **GameData.kt**
   - Employee数据类添加入职日期字段
   - 添加calculateWorkMonths()方法
   - 添加calculateSeverancePay()方法
   - Founder.toEmployee()添加入职日期参数

2. **EmployeeManagementContent.kt**
   - EmployeeManagementContent添加当前日期参数
   - EnhancedFireDialog添加日期和金额参数
   - 解雇对话框显示赔偿详情
   - 解雇时扣除赔偿金额
   - 招聘时记录入职日期

3. **MainActivity.kt**
   - 调用EmployeeManagementContent时传入当前日期
   - 创建创始人员工时使用toEmployee()方法

4. **TalentCandidate.kt**
   - toEmployee()方法添加入职日期参数

5. **RecruitmentService.kt**
   - recruitCandidate()方法添加当前日期参数
   - 招聘时传入入职日期

## 功能特点

### 1. 真实模拟劳动法
- 按照中国劳动法的2N+1赔偿标准
- 工作年数向上取整（有利于员工）
- 不满1年按1年计算

### 2. 详细的信息展示
- 清晰显示员工工作时长
- 展示赔偿计算公式
- 醒目显示赔偿金额
- 资金不足时给出警告

### 3. 完整的数据追踪
- 自动记录员工入职日期
- 招聘时记录当前日期
- 创始人默认从游戏开始就在职

### 4. 用户友好
- 操作前明确显示赔偿金额
- 资金不足时给出提示但不阻止操作
- 支持负债经营（允许资金不足时解雇）

## 存档兼容性

### 旧存档处理
- 旧存档中的员工入职日期默认为1年1月1日
- 不影响游戏正常运行
- 新招聘的员工将正确记录入职日期

### 新游戏
- 创始人入职日期：1年1月1日
- 后续招聘员工自动记录实际入职日期

## 测试建议

### 基本功能测试
1. 招聘新员工，检查入职日期是否正确记录
2. 查看员工卡片，确认入职日期显示
3. 解雇员工，检查赔偿金额计算是否正确
4. 资金不足时解雇员工，确认可以负债

### 边界情况测试
1. 工作不满1个月的员工
2. 工作恰好1年的员工
3. 工作多年的老员工
4. 创始人的赔偿（虽然工资为0，但可以测试逻辑）

### 日期边界测试
1. 入职1月1日，解雇12月30日
2. 入职月末，解雇月初
3. 跨年解雇

## 注意事项

1. **创始人解雇**
   - 创始人月薪为0，赔偿金额也为0
   - 但系统仍然会执行解雇流程

2. **负债经营**
   - 系统允许资金不足时解雇员工
   - 会显示警告但不阻止操作
   - 解雇后资金可能为负数

3. **日期计算**
   - 使用游戏内日期，不受真实时间影响
   - 月数计算精确到天
   - 年数向上取整（有利于员工）

4. **存档兼容**
   - 旧存档员工的入职日期默认为1年1月1日
   - 不影响旧存档的正常使用
   - 新招聘员工将正确记录日期
