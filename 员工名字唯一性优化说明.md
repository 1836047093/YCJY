# 员工名字唯一性优化说明

## 问题描述
原系统中员工名字会出现重复，因为是从固定的30个名字池中随机选择，导致同一个游戏公司中可能有多个"张伟"、"李娜"等同名员工。

## 优化方案

### 1. 扩展名字池（100个名字）
- **文件**: `TalentMarketService.kt`
- **改动**: 将 `CANDIDATE_NAMES` 从30个扩展到100个常见中文名字
- **好处**: 大幅降低名字重复的概率

### 2. 添加唯一名字生成函数
- **函数**: `generateUniqueName(existingNames: Set<String>)`
- **逻辑**:
  1. 优先从名字池中选择未使用的名字
  2. 如果所有基础名字都被使用，自动添加数字后缀（如"张伟2"、"张伟3"）
  3. 确保生成的名字在整个公司范围内唯一

### 3. 修改人才市场服务
**文件**: `TalentMarketService.kt`

修改的函数：
- `generateCandidates()` - 添加 `existingEmployeeNames` 参数
- `refreshCandidates()` - 添加 `existingEmployeeNames` 参数
- `generateCandidateForPosition()` - 添加 `existingEmployeeNames` 参数
- `generateRandomCandidate()` - 修改为接收 `usedNames` 可变集合

### 4. 修改岗位发布服务
**文件**: `JobPostingService.kt`

修改的函数：
- `generateApplicantsForActiveJobs()` - 添加 `existingEmployeeNames` 参数，收集所有已使用的名字
- `generateApplicantsForJob()` - 添加 `existingNames` 参数
- `generateCandidateForJob()` - 添加 `existingNames` 参数
- `conductPlayerInterview()` - 优化代码，移除未使用变量警告

### 5. 修改UI调用点

#### MainActivity.kt
- **位置**: 第1457行，每日时间推进逻辑中
- **改动**: 为岗位发布系统传入当前所有员工的名字集合
```kotlin
val existingEmployeeNames = allEmployees.map { it.name }.toSet()
JobPostingService.getInstance().generateApplicantsForActiveJobs(1, existingEmployeeNames)
```

#### TalentMarketContent.kt
- **位置**: 人才市场界面初始化和刷新按钮
- **改动**: 
  1. 初始化时传入现有员工名字集合
  2. 刷新时传入现有员工+当前候选人的名字集合

## 实现效果

### 名字去重机制
1. **新员工招聘**: 自动避免与现有员工重名
2. **候选人生成**: 人才市场和岗位发布生成的候选人名字不会与现有员工重复
3. **候选人刷新**: 刷新人才市场时，不仅避免与员工重名，还避免与当前候选人重名
4. **数字后缀**: 当100个基础名字都被使用后，自动添加数字后缀（如"张伟2"）

### 示例场景
- 公司已有员工"张伟"
- 人才市场生成候选人时会跳过"张伟"
- 岗位发布生成应聘者时会跳过"张伟"
- 如果100个名字都被使用，新候选人会被命名为"张伟2"、"李娜2"等

## 向后兼容性
- ✅ 完全兼容旧存档
- ✅ 现有员工名字不受影响
- ✅ 只影响新生成的候选人和应聘者

## 技术细节

### 名字池大小
- 原来: 30个名字
- 现在: 100个名字
- 可容纳的独特名字数: 理论上无限（通过数字后缀）

### 性能考虑
- 名字查重使用 `Set` 数据结构，O(1) 时间复杂度
- 生成新名字时先尝试从未使用的基础名字中选择，效率高
- 只有在所有基础名字都被使用后才需要循环查找可用后缀

## 测试建议
1. 创建新游戏，招聘大量员工（>100人），观察名字是否有重复
2. 在人才市场多次刷新候选人，检查名字唯一性
3. 发布岗位，等待应聘者，检查应聘者名字唯一性
4. 长时间游玩，观察名字后缀机制是否正常工作

## 相关文件
- `TalentMarketService.kt` - 核心名字生成逻辑
- `JobPostingService.kt` - 岗位发布应聘者生成
- `MainActivity.kt` - 游戏主逻辑调用
- `TalentMarketContent.kt` - 人才市场UI
