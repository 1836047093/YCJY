# 客服中心一键分配功能说明

## 概述

为客服中心添加了**一键智能分配**功能，可以自动将所有待处理的客诉分配给合适的客服人员，大幅提升管理效率。

## 功能特点

### 1. 智能分配策略

系统会根据以下因素自动选择最合适的客服：

#### 高严重度客诉（🔴高）
- **优先级**：最高
- **分配策略**：
  - 优先分配给**技能最高**的客服
  - 避免分配给工作量过重的客服（工作量≥1000）
  - 如果所有客服都很忙，分配给工作量最少的客服

#### 中等严重度客诉（🟠中）
- **优先级**：中等
- **分配策略**：
  - 分配给技能至少**2级**的客服
  - 优先选择工作量最少的客服
  - 如果没有2级以上客服，分配给工作量最少的客服

#### 低严重度客诉（🟢低）
- **优先级**：普通
- **分配策略**：
  - 直接分配给工作量最少的客服
  - 充分利用低技能客服的能力

### 2. 工作量平衡

系统会实时计算每个客服的当前工作量：

```
工作量 = Σ (未完成客诉的剩余工作量)
剩余工作量 = 总工作量 - 已完成进度
```

**分配时考虑**：
- 避免某个客服过载
- 优先分配给空闲或工作量较少的客服
- 动态平衡团队负载

### 3. 处理顺序

待分配客诉按以下优先级排序：
1. **严重程度**（高→中→低）
2. **创建时间**（早→晚）

确保紧急和早期客诉优先得到处理。

---

## 使用方式

### 触发条件

一键分配按钮会在以下情况显示：
- ✅ 有待处理的客诉（未分配客服）
- ✅ 至少有1名客服人员

### 操作步骤

1. 打开**客服中心**对话框
2. 查看待处理客诉数量
3. 点击**一键分配 (X 个待处理)** 按钮
4. 系统自动完成所有分配

---

## 分配逻辑示例

### 示例1：混合严重度客诉

**当前情况**：
- 客服A（Lv.5，工作量：200）
- 客服B（Lv.3，工作量：400）
- 客服C（Lv.2，工作量：100）

**待分配客诉**：
- 客诉1：高严重度（工作量500）
- 客诉2：中等严重度（工作量250）
- 客诉3：低严重度（工作量100）

**分配结果**：
- 客诉1 → 客服A（技能最高）
- 客诉2 → 客服B（2级以上且工作量适中）
- 客诉3 → 客服C（工作量最少）

### 示例2：客服过载

**当前情况**：
- 客服A（Lv.5，工作量：1200）- 过载
- 客服B（Lv.4，工作量：800）
- 客服C（Lv.3，工作量：500）

**待分配客诉**：
- 客诉1：高严重度（工作量500）

**分配结果**：
- 客诉1 → 客服B（虽然技能略低，但A已过载）

---

## 技术实现

### 核心函数

**CustomerServiceManager.kt**
```kotlin
fun autoAssignComplaints(
    complaints: List<Complaint>,
    employees: List<Employee>
): Pair<List<Complaint>, Int>
```

**返回值**：
- `Pair.first`：更新后的客诉列表
- `Pair.second`：成功分配的客诉数量

### 分配算法流程

```
1. 获取所有可用客服（position == "客服"）
2. 筛选待分配客诉（status == PENDING && assignedEmployeeId == null）
3. 按严重度和时间排序
4. 计算每个客服当前工作量
5. 逐个分配客诉：
   a. 根据严重度选择合适的客服
   b. 更新客诉的assignedEmployeeId
   c. 更新客诉状态为IN_PROGRESS
   d. 累加客服工作量
6. 返回更新结果
```

---

## UI设计

### 按钮样式
- **颜色**：绿色（Color(0xFF10B981)）
- **图标**：✓ 图标（CheckCircle）
- **文本**：一键分配 (X 个待处理)
- **形状**：圆角矩形（8.dp）

### 显示位置
在客服中心对话框中，位于：
- 统计信息（待处理/处理中/本月完成）
- 客诉列表

之间的位置，方便快速操作。

### 响应式显示
- 没有待处理客诉时：不显示按钮
- 没有客服人员时：不显示按钮
- 有待处理且有客服时：显示完整按钮

---

## 优势与效果

### 1. 提升效率
- ⚡ **秒级操作**：一次点击完成所有分配
- ⚡ **无需思考**：系统自动选择最优方案
- ⚡ **批量处理**：适合大量客诉的情况

### 2. 智能决策
- 🧠 **技能匹配**：高难度任务给高技能员工
- 🧠 **负载均衡**：避免某个客服过度疲劳
- 🧠 **优先级处理**：紧急客诉优先分配

### 3. 降低失误
- ✅ **避免遗漏**：所有待处理客诉都会被分配
- ✅ **避免错配**：不会把高难度任务给低技能客服
- ✅ **避免过载**：自动考虑每个客服的工作量

---

## 适用场景

### 推荐使用
1. **客诉较多时**：5个以上待处理客诉
2. **客服充足时**：有多名不同技能等级的客服
3. **紧急情况**：大量客诉需要快速处理

### 手动分配更好
1. **特殊要求**：某个客诉需要指定客服处理
2. **培养新人**：想让低级客服处理简单客诉练手
3. **精细控制**：对工作分配有特殊考虑

---

## 数值设计

### 工作量阈值
- **过载阈值**：1000工作量
  - 超过此值的客服不会再分配高严重度客诉
  - 避免单个客服负担过重

### 技能要求
- **高严重度**：无技能要求，但优先高技能
- **中等严重度**：至少2级技能
- **低严重度**：无技能要求

### 客诉工作量
- **低严重度**：100工作量，7天超时
- **中等严重度**：250工作量，5天超时
- **高严重度**：500工作量，3天超时

---

## 修改的文件

1. **CustomerServiceManager.kt**
   - 添加 `autoAssignComplaints()` 函数
   - 实现智能分配算法

2. **CustomerServiceContent.kt**
   - 添加一键分配按钮
   - 集成自动分配功能
   - 显示待处理客诉数量

---

## 后续优化方向

1. **分配结果提示**：弹出Toast显示"已成功分配X个客诉"
2. **分配详情**：显示每个客服被分配了哪些客诉
3. **自定义策略**：允许玩家选择分配策略（优先平衡/优先速度）
4. **分配预览**：分配前显示预览结果，确认后执行
5. **撤销功能**：一键取消所有刚才的分配

---

## 更新日期
2025-01-24
