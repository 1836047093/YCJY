# 破产机制说明

## 功能概述
当玩家公司负债达到50万时，将触发破产机制，游戏暂停并弹出破产对话框。

## 核心机制

### 破产触发条件
- **触发时机**：每月结算后
- **触发条件**：`money < -500000L`（负债达到50万）
- **触发效果**：
  - 游戏自动暂停（`isPaused = true`）
  - 显示破产对话框（`showBankruptcyDialog = true`）

### 破产对话框
**对话框特性**：
- 不可通过点击外部区域关闭
- 必须选择一个选项才能继续
- 显示当前资金状况

**UI元素**：
1. **标题**：
   - 破产图标：💸（48sp）
   - 标题文字："公司破产"（红色，24sp）

2. **内容**：
   - "负债已达到 ¥50万！"
   - 显示当前资金（红色显示）
   - "公司已无力继续经营..."

3. **操作按钮**：
   - **读取存档**（蓝色按钮）：
     - 图标：📁 (FolderOpen)
     - 功能：导航到存档读取界面
     - 路由：`navController.navigate("continue")`
   
   - **重新开始**（绿色描边按钮）：
     - 图标：🔄 (Refresh)
     - 功能：重新创建游戏
     - 路由：`navController.navigate("game_setup")`
     - 清除当前游戏进度

## 代码实现

### 1. 状态管理
```kotlin
// 破产对话框状态
var showBankruptcyDialog by remember { mutableStateOf(false) }
```

### 2. 破产检查逻辑
```kotlin
// 月结算后检查是否破产（负债达到50万）
if (money < -500000L) {
    isPaused = true
    showBankruptcyDialog = true
    Log.d("MainActivity", "公司破产：当前资金 ¥$money")
}
```

### 3. 对话框UI
位置：`MainActivity.kt` 第1753-1849行
- 使用 `AlertDialog` 组件
- 自定义标题和内容布局
- 两个全宽按钮垂直排列

## 修改文件
- **MainActivity.kt**：
  - 添加破产对话框状态变量（第1039行）
  - 添加破产检查逻辑（第1181-1186行）
  - 添加破产对话框UI（第1753-1849行）
  - 添加必要的Icons导入（第39-41行）

## 玩家体验流程

1. **正常游戏**：
   - 玩家进行游戏开发和运营
   - 可能因为高额开支导致负债累积

2. **破产触发**：
   - 月结算时检测到负债≥50万
   - 游戏暂停，无法继续操作
   - 弹出破产对话框

3. **玩家选择**：
   - **选项A**：读取之前的存档，回到之前的游戏状态
   - **选项B**：重新开始，创建新的游戏

## 注意事项

1. **存档保存**：
   - 破产前建议经常保存游戏
   - 可以通过读取存档恢复到破产前的状态

2. **负债管理**：
   - 密切关注资金状况
   - 避免过度招聘员工
   - 控制服务器成本
   - 确保游戏有足够收益

3. **预警建议**：
   - 当资金为负时应谨慎经营
   - 负债超过30万时需要重点关注
   - 可以通过裁员、关闭服务器等方式减少开支

## 未来优化方向

1. **破产预警**：
   - 当负债达到30万时显示警告提示
   - 在资金显示处添加危险标识

2. **破产宽限期**：
   - 给玩家1-2个月的缓冲时间
   - 在此期间想办法扭亏为盈

3. **贷款系统**：
   - 允许玩家向银行贷款渡过难关
   - 设置利息和还款期限

4. **资产变卖**：
   - 允许玩家出售游戏版权
   - 变卖非核心资产

## 测试建议

测试破产机制的方法：
1. 招聘大量高薪员工
2. 开设多个高成本服务器
3. 不发布任何游戏（无收入）
4. 等待月结算，资金会快速下降
5. 当负债达到50万时触发破产
