package com.example.yjcy.utils

import com.example.yjcy.data.PlayerComment
import kotlin.random.Random

/**
 * 玩家评论生成器
 * 根据游戏更新内容智能生成玩家评论
 */
object CommentGenerator {
    
    // 玩家昵称库
    private val playerNames = listOf(
        "游戏狂热者", "夜猫子玩家", "小白兔", "大神路过", "新手村村长",
        "满级大佬", "氪金玩家", "白嫖党", "肝帝", "佛系玩家",
        "竞技场之王", "副本杀手", "收集狂魔", "成就党", "剧情党",
        "PVP高手", "PVE爱好者", "休闲玩家", "策略大师", "操作怪",
        "云玩家", "测试玩家", "萌新一只", "老玩家", "回坑玩家",
        "技术流", "暴力流", "稳健型", "激进派", "保守派",
        "欧皇在此", "非酋本人", "脸黑玩家", "幸运之子", "天选之人",
        "无名英雄", "默默无闻", "低调大佬", "高调菜鸟", "中等玩家"
    )
    
    // 评论模板库（按更新内容类型分类）
    private val commentTemplates = mapOf(
        // 皮肤相关
        "新皮肤" to listOf(
            "新皮肤太好看了！必须买买买！",
            "这个皮肤的设计真的很用心",
            "皮肤很不错，但是价格有点贵...",
            "终于出新皮肤了，等了好久",
            "这次的皮肤质量很高，点个赞",
            "皮肤特效做得很棒",
            "又要氪金了，钱包保不住了",
            "免费玩家表示只能看看",
            "皮肤很炫酷，值得入手",
            "这个皮肤让我的角色帅爆了"
        ),
        
        // 道具相关
        "新道具" to listOf(
            "新道具很实用，推荐入手",
            "这个道具有点鸡肋啊",
            "道具效果不错，性价比可以",
            "又出新道具了，更新速度挺快",
            "道具属性感觉还行",
            "这道具是必需品吗？",
            "买了个道具试试看",
            "道具价格还算合理",
            "新道具让游戏体验提升了",
            "道具商店又更新了"
        ),
        
        // 装备相关
        "新装备" to listOf(
            "新装备属性爆炸，必须搞一套",
            "装备很强，但是获取难度太高了",
            "这次装备更新挺给力的",
            "终于出新装备了，旧装备可以退役了",
            "装备外观和属性都很棒",
            "新装备让战力飙升",
            "又要肝装备了，累...",
            "装备掉落率能不能高一点",
            "这套装备我要定了",
            "装备系统越来越完善了"
        ),
        
        // 赛季相关
        "新赛季" to listOf(
            "新赛季来了，又可以冲榜了",
            "赛季奖励很丰富啊",
            "这赛季的任务有点难",
            "赛季玩法很有意思",
            "又是新赛季，又要肝了",
            "赛季通行证值得买",
            "赛季内容很充实",
            "新赛季的主题不错",
            "冲击赛季榜单中",
            "赛季更新频率刚刚好"
        ),
        
        // 角色相关
        "新角色" to listOf(
            "新角色太强了，必须抽",
            "又出新角色，上个角色还没玩明白",
            "这个角色的技能很有创意",
            "新角色建模很精致",
            "角色强度感觉有点超标",
            "又要攒资源抽角色了",
            "新角色的配音很好听",
            "这角色操作难度有点高",
            "终于等到这个角色了",
            "新角色让阵容更加多样化"
        ),
        
        // 关卡相关
        "新关卡" to listOf(
            "新关卡难度适中，很有挑战性",
            "关卡设计得不错",
            "这关卡太难了，打了好多次",
            "新关卡奖励很丰厚",
            "关卡剧情很有意思",
            "终于通关新关卡了",
            "关卡机制很新颖",
            "又有新关卡可以刷了",
            "关卡BOSS有点难打",
            "新关卡的场景很漂亮"
        ),
        
        // 地图相关
        "新地图" to listOf(
            "新地图太棒了，场景很漂亮",
            "终于出新地图了，又有新图玩了",
            "地图设计很用心",
            "新地图探索起来很有意思",
            "这个地图的细节做得很好",
            "地图优化得不错，不卡了",
            "新地图的玩法很新鲜",
            "地图面积好大，慢慢探索",
            "又要熟悉新地图了",
            "新地图让游戏内容更丰富了"
        ),
        
        // 模式相关
        "新模式" to listOf(
            "新模式很有创意，好玩",
            "这个模式玩法很新颖",
            "模式更新得很及时",
            "新模式让游戏更有趣了",
            "终于出新模式了，期待已久",
            "这模式有点硬核",
            "新模式的规则挺有意思",
            "又多了个模式可以玩",
            "模式奖励还不错",
            "新模式给游戏注入了新活力"
        ),
        
        // 武器相关
        "新武器" to listOf(
            "新武器伤害爆炸，太强了",
            "武器手感很不错",
            "这把武器的外观很酷",
            "新武器让战斗更爽快了",
            "武器平衡性还可以",
            "又要练新武器了",
            "这武器配合我的玩法很合适",
            "新武器技能很华丽",
            "武器获取方式还算简单",
            "武器种类越来越多了"
        ),
        
        // 任务相关
        "新任务" to listOf(
            "新任务奖励很丰富",
            "任务难度刚刚好",
            "这次任务有点肝",
            "任务内容很有趣",
            "终于做完新任务了",
            "任务更新得很快",
            "新任务让我有目标了",
            "任务系统越来越完善",
            "每日任务又多了",
            "任务奖励还算可以"
        ),
        
        // 系统相关
        "新系统" to listOf(
            "新系统很实用",
            "系统优化得不错",
            "这个系统功能很强大",
            "新系统让游戏体验提升了",
            "系统界面设计得很好看",
            "又要学习新系统了",
            "系统更新得很及时",
            "这个系统解决了痛点",
            "新系统操作很方便",
            "系统越来越完善了"
        ),
        
        // 活动相关
        "新活动" to listOf(
            "新活动奖励很给力",
            "活动内容很丰富",
            "这次活动很有意思",
            "活动福利不错",
            "终于等到新活动了",
            "活动玩法很新颖",
            "又要肝活动了",
            "活动时间太短了",
            "新活动参与度很高",
            "活动让游戏更热闹了"
        ),
        
        // 剧情相关
        "新剧情" to listOf(
            "新剧情很精彩，期待后续",
            "剧情发展很有意思",
            "这次剧情质量很高",
            "剧情CG做得很棒",
            "终于更新新剧情了",
            "剧情反转太惊喜了",
            "剧情党表示很满足",
            "这个剧情让我很感动",
            "剧情配音很用心",
            "新剧情让世界观更丰富了"
        ),
        
        // 优化相关
        "优化" to listOf(
            "优化后流畅多了",
            "这次优化很到位",
            "终于优化了这个问题",
            "优化让游戏体验提升了",
            "希望继续优化",
            "优化得不错，点赞",
            "游戏越来越流畅了",
            "优化后Bug少了很多",
            "这次优化解决了卡顿",
            "性能优化很明显"
        )
    )
    
    /**
     * 为更新内容生成玩家评论
     * @param updateContent 更新内容列表
     * @param commentCount 生成评论数量（默认5-10条）
     * @return 玩家评论列表
     */
    fun generateComments(
        updateContent: List<String>,
        commentCount: Int = Random.nextInt(5, 11)
    ): List<PlayerComment> {
        val comments = mutableListOf<PlayerComment>()
        
        // 如果没有更新内容，返回空列表
        if (updateContent.isEmpty()) return comments
        
        // 生成指定数量的评论
        repeat(commentCount) {
            // 随机选择一个更新内容
            val content = updateContent.random()
            
            // 根据更新内容类型获取评论模板
            val templates = findTemplatesForContent(content)
            
            // 随机选择一个评论模板
            val commentText = templates.random()
            
            // 随机生成玩家昵称
            val playerName = playerNames.random() + Random.nextInt(1000, 9999)
            
            // 随机生成点赞数（0-500）
            // 热门评论（10%概率）：200-500赞
            // 普通评论（90%概率）：0-100赞
            val likes = if (Random.nextFloat() < 0.1f) {
                Random.nextInt(200, 501)
            } else {
                Random.nextInt(0, 101)
            }
            
            comments.add(
                PlayerComment(
                    playerName = playerName,
                    content = commentText,
                    likes = likes
                )
            )
        }
        
        // 按点赞数降序排序
        return comments.sortedByDescending { it.likes }
    }
    
    /**
     * 根据更新内容查找对应的评论模板
     */
    private fun findTemplatesForContent(content: String): List<String> {
        // 尝试精确匹配
        commentTemplates[content]?.let { return it }
        
        // 尝试模糊匹配
        for ((key, templates) in commentTemplates) {
            if (content.contains(key) || key.contains(content)) {
                return templates
            }
        }
        
        // 如果没有匹配，返回通用评论
        return listOf(
            "这次更新不错",
            "更新内容挺好的",
            "期待下次更新",
            "更新速度可以",
            "支持游戏更新",
            "更新很及时",
            "内容很丰富",
            "继续加油",
            "游戏越来越好了",
            "一直在支持这个游戏"
        )
    }
    
    /**
     * 生成默认更新公告
     * @param updateContent 更新内容列表
     * @return 默认公告文本
     */
    fun generateDefaultAnnouncement(updateContent: List<String>): String {
        if (updateContent.isEmpty()) return "本次更新进行了游戏优化"
        
        val contentList = updateContent.joinToString("、")
        return "本次更新内容包括：$contentList，感谢各位玩家的支持！"
    }
}
