# 自动审批员工涨薪功能说明

## 功能概述

在游戏设置中新增了"自动审批"功能，玩家可以选择是否自动同意员工的涨薪请求。开启后，当员工提出涨薪要求时，系统会自动审批并完成涨薪操作，无需玩家手动点击同意按钮。

## 功能位置

**游戏设置 → 自动审批**

位于游戏内设置界面，在"自动存档"选项之后。

## 使用方法

### 开启自动审批
1. 进入游戏后，点击设置按钮⚙️
2. 在设置界面找到"💰 自动审批"选项
3. 点击右侧开关，开启自动审批功能
4. 开启后显示："已开启：自动同意员工涨薪请求"

### 关闭自动审批
1. 进入游戏设置
2. 点击"自动审批"右侧开关
3. 关闭后显示："已关闭：需手动审批"
4. 关闭后需要手动处理每个员工的涨薪请求

## 功能特性

### 自动审批模式（开启时）
- ✅ 员工提出涨薪请求时，系统自动同意
- ✅ 自动更新员工薪资为要求的金额
- ✅ 自动提升员工忠诚度+10
- ✅ 自动增加员工涨薪次数
- ✅ 不弹出涨薪对话框，游戏不暂停
- ✅ 在日志中显示："✅ 自动审批：XXX (第N次涨薪) 薪资从¥XX涨到¥XX"

### 手动审批模式（关闭时）
- 💬 员工提出涨薪请求时，弹出对话框
- 💬 显示员工信息和涨薪详情
- 💬 玩家可以选择"同意"或"拒绝"
- 💬 游戏暂停，等待玩家决策
- 💬 在日志中显示："💼 涨薪请求：XXX (第N次涨薪) 要求薪资从¥XX涨到¥XX"

## 涨薪规则（不受开关影响）

### 涨薪时机
- **首次涨薪**：入职1年后
- **第二次涨薪**：入职3年后
- **第三次涨薪**：入职5年后
- **最多涨薪**：每位员工最多涨薪3次

### 涨薪幅度
计算公式：`期望薪资 = 基础薪资 × (1 + 技能等级 × 5% + 涨薪次数 × 3%)`

**示例：**
- 3级员工首次涨薪：`基础薪资 × (1 + 3×5% + 1×3%) = 118%`
- 5级员工第三次涨薪：`基础薪资 × (1 + 5×5% + 3×3%) = 134%`

### 涨薪效果
- **同意涨薪**：
  - ✅ 薪资更新为要求的金额
  - ✅ 忠诚度+10
  - ✅ 涨薪次数+1
  - ✅ 清除涨薪请求标记

- **拒绝涨薪**（仅手动模式）：
  - ❌ 薪资不变
  - ❌ 忠诚度-20
  - ❌ 清除涨薪请求标记
  - ⚠️ 可能导致员工离职或被竞争对手挖走

## 技术实现

### 1. 数据存储
在 `SaveData` 中添加了 `autoApproveSalaryIncrease` 字段：
```kotlin
val autoApproveSalaryIncrease: Boolean = false // 自动审批员工涨薪开关（默认关闭）
```

### 2. UI界面
在 `InGameSettingsContent` 中添加了自动审批开关：
```kotlin
// 自动审批涨薪开关
Card(
    ...
) {
    Row(...) {
        Text(text = "💰")
        Column {
            Text(text = "自动审批")
            Text(text = if (autoApproveSalaryIncrease) "已开启：自动同意员工涨薪请求" else "已关闭：需手动审批")
        }
        Switch(
            checked = autoApproveSalaryIncrease,
            onCheckedChange = { onAutoApproveSalaryToggle(it) }
        )
    }
}
```

### 3. 自动审批逻辑
在每日检查涨薪请求时，判断是否开启自动审批：
```kotlin
if (autoApproveSalaryIncrease) {
    // 自动审批：直接同意涨薪
    val finalUpdatedEmployees = allEmployees.map { emp ->
        if (emp.id == employeeNeedingSalaryIncrease.id) {
            emp.copy(
                salary = expectedSalary,
                loyalty = (emp.loyalty + 10).coerceAtMost(100),
                requestedSalary = null,
                salaryRequestCount = emp.salaryRequestCount + 1
            )
        } else {
            emp
        }
    }
    allEmployees.clear()
    allEmployees.addAll(finalUpdatedEmployees)
    
    Log.d("MainActivity", "✅ 自动审批：${employeeNeedingSalaryIncrease.name} (第${employeeNeedingSalaryIncrease.salaryRequestCount + 1}次涨薪) 薪资从¥${employeeNeedingSalaryIncrease.salary}涨到¥$expectedSalary")
} else {
    // 手动审批：显示涨薪请求对话框
    showSalaryRequestDialog = true
    isPaused = true
}
```

## 使用建议

### 适合开启自动审批的情况
- ✅ 资金充裕，不在意薪资支出
- ✅ 希望保持员工高忠诚度
- ✅ 不想被涨薪请求打断游戏节奏
- ✅ 人才管理采用"放养"策略

### 适合关闭自动审批的情况
- ⚠️ 资金紧张，需要控制成本
- ⚠️ 希望手动管理每位员工
- ⚠️ 想根据员工表现决定是否涨薪
- ⚠️ 采用精细化的人才管理策略

## 注意事项

1. **自动审批不影响创始人**
   - 创始人永远不会提出涨薪请求
   - 该功能仅对普通员工有效

2. **自动审批只处理新请求**
   - 开启自动审批后，只会自动处理之后的涨薪请求
   - 开启前已经提出的请求仍需手动处理

3. **自动审批会增加支出**
   - 每次自动同意涨薪都会增加每月支出
   - 建议根据公司财务状况决定是否开启

4. **存档兼容性**
   - 旧存档默认关闭自动审批
   - 新存档会保存自动审批开关状态

## 修改文件列表

1. `app/src/main/java/com/example/yjcy/data/GameData.kt`
   - 添加 `autoApproveSalaryIncrease` 字段

2. `app/src/main/java/com/example/yjcy/MainActivity.kt`
   - 添加状态变量
   - 添加UI开关
   - 实现自动审批逻辑
   - 存档时保存开关状态

## 测试建议

1. **基础功能测试**
   - 开启自动审批，等待员工涨薪请求
   - 验证是否自动同意且不弹对话框

2. **存档测试**
   - 开启自动审批后保存游戏
   - 读取存档，验证开关状态是否保持

3. **效果测试**
   - 验证自动同意后员工薪资是否更新
   - 验证忠诚度是否+10
   - 验证涨薪次数是否+1

## 版本信息
- **添加日期**: 2025-11-02
- **功能状态**: ✅ 已完成
- **兼容性**: 向后兼容所有旧存档

