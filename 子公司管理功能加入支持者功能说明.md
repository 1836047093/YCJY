# 子公司管理功能加入支持者功能说明

## 修改概述

将**子公司管理功能**（收购竞争对手）加入到支持者功能中，玩家需要通过爱发电兑换码解锁才能使用收购竞争对手功能。

## 修改内容

### 1. 支持者功能枚举更新

**文件**: `RedeemCodeManager.kt`

在 `SupporterFeature` 枚举中新增：
```kotlin
SUBSIDIARY_MANAGEMENT  // 子公司管理功能（收购竞争对手）
```

### 2. 竞争对手界面权限检查

**文件**: `CompetitorScreen.kt`

#### 修改的函数：

1. **CompetitorContent**
   - 新增参数：`isSupporterUnlocked: Boolean`
   - 新增参数：`onShowFeatureLockedDialog: () -> Unit`
   - 作用：接收支持者功能解锁状态并传递给子组件

2. **CompetitorsListContent**
   - 新增参数：`isSupporterUnlocked: Boolean`
   - 新增参数：`onShowFeatureLockedDialog: () -> Unit`
   - 作用：传递权限检查参数给详情对话框

3. **CompetitorDetailDialog**
   - 新增参数：`isSupporterUnlocked: Boolean`
   - 新增参数：`onShowFeatureLockedDialog: () -> Unit`
   - **核心修改**：在"💰 收购"按钮点击时添加权限检查：
     ```kotlin
     Button(
         onClick = { 
             // 检查是否解锁子公司管理功能
             if (!isSupporterUnlocked) {
                 onShowFeatureLockedDialog()
             } else {
                 showAcquisitionDialog = true
             }
         },
         ...
     )
     ```

### 3. MainActivity 集成

**文件**: `MainActivity.kt`

#### 竞争对手界面调用
在 `CompetitorContent` 调用时添加：
```kotlin
isSupporterUnlocked = isSupporterUnlocked,
onShowFeatureLockedDialog = { showFeatureLockedDialog = true }
```

#### 子公司管理菜单入口
在 `CompetitorMenuDialog` 的 `onSubsidiaryManagement` 回调中添加权限检查：
```kotlin
onSubsidiaryManagement = {
    // 检查是否解锁子公司管理功能
    if (!isSupporterUnlocked) {
        showFeatureLockedDialog = true
        showCompetitorMenu = false
    } else {
        // 显示子公司管理界面
        showSubsidiaryManagement = true
        showCompetitorMenu = false
    }
}
```

## 功能流程

### 未解锁时：
1. 玩家点击竞争对手详情中的"💰 收购"按钮
2. 系统检测到 `isSupporterUnlocked = false`
3. 弹出爱发电提示对话框：
   - 标题："功能未解锁"
   - 内容："该功能需通过爱发电赞助解锁，您的支持将直接用于游戏内容迭代与开发。"
   - 按钮："去爱发电支持" / "稍后再说"

### 已解锁时：
1. 玩家点击"💰 收购"按钮
2. 正常进入收购竞价流程
3. 收购成功后，竞争对手转为子公司

## 用户体验

### 权限检查点：
1. ✅ **竞争对手详情 - 收购按钮**：点击时检查权限
2. ✅ **子公司管理菜单入口**：点击时检查权限

### 未解锁玩家：
- 可以正常查看竞争对手信息
- 可以查看排行榜和新闻
- **无法收购竞争对手**
- 点击收购按钮时显示爱发电提示

### 已解锁玩家：
- 所有功能正常使用
- 可以收购竞争对手
- 可以管理子公司

## 向后兼容

- ✅ 所有新增参数都有默认值 `false` 或空函数
- ✅ 旧代码不受影响
- ✅ 未使用兑换码的玩家默认为未解锁状态

## 修改的文件列表

1. `app/src/main/java/com/example/yjcy/utils/RedeemCodeManager.kt`
   - 添加 `SUBSIDIARY_MANAGEMENT` 枚举值

2. `app/src/main/java/com/example/yjcy/ui/CompetitorScreen.kt`
   - `CompetitorContent` 添加权限参数
   - `CompetitorsListContent` 添加权限参数
   - `CompetitorDetailDialog` 添加权限参数和检查逻辑

3. `app/src/main/java/com/example/yjcy/MainActivity.kt`
   - 调用 `CompetitorContent` 时传递权限参数
   - 子公司管理菜单添加权限检查

## 测试建议

### 测试场景1：未解锁玩家
1. 使用未兑换支持者码的账号
2. 进入竞争对手界面
3. 查看竞争对手详情
4. 点击"💰 收购"按钮
5. **预期**：弹出爱发电提示对话框

### 测试场景2：已解锁玩家
1. 使用已兑换支持者码的账号
2. 进入竞争对手界面
3. 查看竞争对手详情
4. 点击"💰 收购"按钮
5. **预期**：正常进入收购竞价流程

### 测试场景3：子公司管理入口
1. 使用未解锁账号
2. 点击底部导航的"🎯 竞争对手"
3. 在弹出菜单中点击"子公司管理"
4. **预期**：弹出爱发电提示对话框

## 相关文档

- 支持者功能系统设计
- 兑换码系统实现说明
- 竞争对手和子公司系统说明

---

**修改日期**：2025-01-24
**修改人**：Cascade AI
**版本**：2.0.9+
