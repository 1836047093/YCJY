# 战队管理解锁功能实现说明

## 功能概述

战队管理功能现在需要首次解锁才能使用：
1. **解锁费用**：1亿资金
2. **解锁流程**：
   - 确认支付1亿解锁费用
   - 输入战队名称（最多10个字符）
   - 选择队徽颜色和样式
3. **解锁后**：永久开启战队管理功能

## 已完成的修改

### 1. SaveData 新增字段（GameData.kt）

```kotlin
data class SaveData(
    // ... 其他字段
    val esportsTeamUnlocked: Boolean = false, // 战队管理功能是否解锁（需要1亿资金解锁）
)
```

### 2. TeamManagementScreen 新增参数

```kotlin
@Composable
fun TeamManagementScreen(
    // ... 其他参数
    isTeamUnlocked: Boolean = false,
    onUnlockTeam: (String, TeamLogoConfig) -> Unit = { _, _ -> }
)
```

### 3. 新增 TeamUnlockDialog 组件

三步解锁流程：
- **第一步**：显示解锁费用和当前资金，确认是否解锁
- **第二步**：输入战队名称（1-10个字符）
- **第三步**：选择队徽颜色（8种预设颜色）

## 需要集成的代码

### 在 GameScreen 中调用 TeamManagementScreen

找到调用 `TeamManagementScreen` 的地方，添加以下参数：

```kotlin
// 在 GameScreen 的状态变量中添加
var saveData by remember { 
    mutableStateOf(
        SaveData(
            // ... 其他初始化
            esportsTeamUnlocked = false
        )
    )
}

// 调用 TeamManagementScreen 时传递参数
TeamManagementScreen(
    onNavigateBack = { /* 返回逻辑 */ },
    teamLogoConfig = saveData.teamLogo,
    onUpdateTeamLogo = { newConfig ->
        saveData = saveData.copy(teamLogo = newConfig)
    },
    money = saveData.money,
    fans = saveData.fans,
    year = saveData.currentYear,
    month = saveData.currentMonth,
    day = saveData.currentDay,
    gameSpeed = gameSpeed,
    onSpeedChange = { newSpeed -> gameSpeed = newSpeed },
    onPauseToggle = { isPaused = !isPaused },
    isPaused = isPaused,
    onSettingsClick = { /* 设置逻辑 */ },
    isSupporterUnlocked = saveData.isSupporterUnlocked,
    onShowFeatureLockedDialog = { /* 功能锁定提示 */ },
    // 新增：战队解锁相关
    isTeamUnlocked = saveData.esportsTeamUnlocked,
    onUnlockTeam = { teamName, logoConfig ->
        // 扣除1亿资金
        val unlockCost = 100_000_000L
        if (saveData.money >= unlockCost) {
            saveData = saveData.copy(
                money = saveData.money - unlockCost,
                esportsTeamUnlocked = true,
                teamLogo = logoConfig.copy(teamName = teamName)
            )
            
            // 记录资金流水
            addMoneyLog(
                date = GameDate(saveData.currentYear, saveData.currentMonth, saveData.currentDay),
                amount = -unlockCost,
                reason = "解锁战队管理",
                category = "战队"
            )
            
            // 显示成功提示
            Toast.makeText(
                context,
                "✅ 战队管理已解锁！欢迎来到电竞世界！",
                Toast.LENGTH_LONG
            ).show()
        }
    }
)
```

## 用户体验流程

### 首次进入战队管理

1. 玩家点击"战队管理"按钮
2. 弹出解锁对话框，显示：
   - 解锁费用：¥1亿
   - 当前资金：¥X万
   - 如果资金不足，"解锁"按钮禁用
3. 玩家点击"解锁"按钮

### 输入战队名称

1. 显示输入框，要求输入战队名称
2. 限制：1-10个字符
3. 示例：YJCY Gaming
4. 可以点击"上一步"返回

### 选择队徽

1. 显示队徽预览（动态效果）
2. 提供8种颜色选择：
   - 红色、青色、蓝色、绿色
   - 黄色、粉色、紫色、橙色
3. 点击颜色圆圈即可切换
4. 可以点击"上一步"返回修改战队名

### 完成解锁

1. 点击"完成"按钮
2. 扣除1亿资金
3. 保存战队配置
4. 关闭对话框，进入战队管理界面

## 后续进入

解锁后，玩家再次进入战队管理时：
- 不再显示解锁对话框
- 直接进入战队管理界面
- 可以在"俱乐部信息"Tab中修改队徽

## 注意事项

1. **资金检查**：确保玩家有足够的资金才能解锁
2. **存档兼容**：旧存档默认 `esportsTeamUnlocked = false`，需要重新解锁
3. **资金流水**：记录解锁费用到资金流水中
4. **战队名称**：保存到 `teamLogo.teamName` 字段
5. **队徽配置**：保存到 `teamLogo` 字段

## 测试建议

1. 测试资金不足时的提示
2. 测试输入空战队名称时的禁用状态
3. 测试颜色选择的视觉效果
4. 测试解锁后再次进入不显示对话框
5. 测试存档保存和加载

## 视觉效果

- 解锁对话框使用深色主题（0xFF1E1E2E）
- 队徽预览使用动态旋转和脉冲效果
- 颜色选择使用圆形按钮，选中时显示白色边框和勾选标记
- 按钮使用绿色（0xFF4CAF50）表示确认操作

## 后续优化建议

1. 可以添加解锁动画效果
2. 可以添加更多队徽样式选择
3. 可以添加队徽图案选择（盾形、圆形、菱形等）
4. 可以添加队徽预设模板
